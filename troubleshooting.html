

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; CONCEPT Documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://jmd-dk.github.io/concept/troubleshooting.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Publications" href="publications.html" />
    <link rel="prev" title="The watch utility" href="utilities/watch.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: darkorange" >
          

          
            <a href="index.html" class="icon icon-home"> CO<em>N</em>CEPT
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial/tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial/installation.html">1. Effortless installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/first_simulations.html">2. Your first simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/first_simulations.html#the-concept-script">2.1. The <code class="docutils literal notranslate"><span class="pre">concept</span></code> script</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/first_simulations.html#don-t-forget-about-gravity">2.2. Don’t forget about gravity</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/parameter_files.html">3. Working with parameter files</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/output_types.html">4. Other kinds of output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#d-renders">4.1. 3D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#id1">4.2. 2D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#snapshots">4.3. Snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/working_remotely.html">5. Working on remote clusters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/working_remotely.html#submitting-jobs">5.1. Submitting jobs</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/working_remotely.html#using-pre-installed-mpi-library">5.2. Using pre-installed MPI library</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/beyond_matter_only.html">6. Beyond matter-only simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#adding-linear-speciess">6.1. Adding linear speciess</a><ul>
<li class="toctree-l4"><a class="reference internal" href="tutorial/beyond_matter_only.html#massive-neutrinos">6.1.1. Massive neutrinos</a></li>
<li class="toctree-l4"><a class="reference internal" href="tutorial/beyond_matter_only.html#dynamical-dark-energy">6.1.2. Dynamical dark energy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#decaying-cold-dark-matter">6.2. Decaying cold dark matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#non-linear-massive-neutrinos">6.3. Non-linear massive neutrinos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/utilities.html">7. Using utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-powerspec-and-render-utilities">7.1. The powerspec and render utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-class-utility">7.2. The CLASS utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-update-utility">7.3. The update utility</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#standard-installation">Standard installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#optimal-network-performance-on-clusters">Optimal network performance on clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#the-installer-script-in-depth">The <code class="docutils literal notranslate"><span class="pre">installer</span></code> script in-depth</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#programs-installed">Programs installed</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#command-line-options">Command-line options</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#influential-environment-variables">Influential environment variables</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#dependencies">Dependencies</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#the-paths-and-env-files">The <code class="docutils literal notranslate"><span class="pre">.paths</span></code> and <code class="docutils literal notranslate"><span class="pre">.env</span></code> files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#the-paths-file">The <code class="docutils literal notranslate"><span class="pre">.paths</span></code> file</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#the-env-file">The <code class="docutils literal notranslate"><span class="pre">.env</span></code> file</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_options.html">Command-line options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#basics">Basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#remote-job-submission">Remote job submission</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#other-modes-of-building-running">Other modes of building/running</a></li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#specials">Specials</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters/parameters.html">Parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parameters/input_output.html">Input/output</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/numerical_parameters.html">Numerical parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/cosmology.html">Cosmology</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/physics.html">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/simulation_options.html">Simulation options</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/graphics.html">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/system_of_units.html">System of units</a></li>
<li class="toctree-l2"><a class="reference internal" href="parameters/debugging_options.html">Debugging options</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utilities/utilities.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utilities/class.html">The CLASS utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/convert.html">The convert utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/info.html">The info utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/play.html">The play utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/powerspec.html">The powerspec utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/render2D.html">The render2D utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/render3D.html">The render3D utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/update.html">The update utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/watch.html">The watch utility</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation-failed">Installation failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#terminal-color-output-looks-weird">Terminal color output looks weird</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crashes-or-other-bad-behavior">Crashes or other bad behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bad-performance-when-using-multiple-processes-nodes">Bad performance when using multiple processes/nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-when-running-remotely">Problems when running remotely</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-when-using-multiple-nodes">Problems when using multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="publications.html#theses">Theses</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CO<em>N</em>CEPT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/jmd-dk/concept/" class="fa fa-github"> Code Repository</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      

      
      

      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>This page contains solutions to and helpful information about possible issues
encountered when using CO<em>N</em>CEPT. If help from this page is insufficient
to solve your problem, do not hesitate to
<a class="reference external" href="https://github.com/jmd-dk/concept/issues">open an issue</a> or contact the
author at
<span class="raw-html"><td class="field-body"><a class="reference external" href="mailto:dakin&#37;&#52;&#48;phys&#46;au&#46;dk">dakin<span>&#64;</span>phys<span>&#46;</span>au<span>&#46;</span>dk</a></td></span>.</p>
<p>Entries on this page:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation-failed" id="id3">Installation failed</a></p></li>
<li><p><a class="reference internal" href="#terminal-color-output-looks-weird" id="id4">Terminal color output looks weird</a></p></li>
<li><p><a class="reference internal" href="#crashes-or-other-bad-behavior" id="id5">Crashes or other bad behavior</a></p></li>
<li><p><a class="reference internal" href="#bad-performance-when-using-multiple-processes-nodes" id="id6">Bad performance when using multiple processes/nodes</a></p></li>
<li><p><a class="reference internal" href="#problems-when-running-remotely" id="id7">Problems when running remotely</a></p></li>
<li><p><a class="reference internal" href="#problems-when-using-multiple-nodes" id="id8">Problems when using multiple nodes</a></p></li>
</ul>
</div>
<div class="section" id="installation-failed">
<h2><a class="toc-backref" href="#id3">Installation failed</a><a class="headerlink" href="#installation-failed" title="Permalink to this headline">¶</a></h2>
<p>We strive for a trivial installation process on as many Linux systems as
possible. If the <a class="reference internal" href="tutorial/installation.html"><span class="doc">simple installation process</span></a>
(with every dependency allowed to be installed from scratch) keeps failing
for some inexplicable reason, you may try looking for a clue in the logged
installation output (of which there are a lot), in the <code class="docutils literal notranslate"><span class="pre">install_log</span></code> and
<code class="docutils literal notranslate"><span class="pre">install_log_err</span></code> files.</p>
<p>It may happen that some dependency program fails to install due to some other
dependency not working correctly. You may try adding the <code class="docutils literal notranslate"><span class="pre">--test</span></code> option
when invoking the <code class="docutils literal notranslate"><span class="pre">installer</span></code>, which test most of the dependency programs
after/during their individual installation. Carefully looking through the
installation log files for failed tests may then reveal something.</p>
</div>
<div class="section" id="terminal-color-output-looks-weird">
<h2><a class="toc-backref" href="#id4">Terminal color output looks weird</a><a class="headerlink" href="#terminal-color-output-looks-weird" title="Permalink to this headline">¶</a></h2>
<p>CO<em>N</em>CEPT includes a lot of color and other formatting in its terminal
output. While all modern terminal emulators on Linux fully support this, the
story is different on other platforms. If you run CO<em>N</em>CEPT from macOS
(via ssh into a cluster) and the colors appear all wrong, try installing
the superior <a class="reference external" href="https://www.iterm2.com/">iTerm2</a> terminal emulator. If you
are running CO<em>N</em>CEPT from Windows (through e.g. putty), no proper
solution is known.</p>
<p>If you want to disable color and other formatted output alltogether, set</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">enable_terminal_formatting</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>in your parameter files. Note that though this eliminates most formatting,
a few elements are still formatted.</p>
</div>
<div class="section" id="crashes-or-other-bad-behavior">
<h2><a class="toc-backref" href="#id5">Crashes or other bad behavior</a><a class="headerlink" href="#crashes-or-other-bad-behavior" title="Permalink to this headline">¶</a></h2>
<p>This entry is concerned with problems encountered when using CO<em>N</em>CEPT
<em>locally</em>. If your problem occurs only for remote jobs, please see the
‘<a class="reference internal" href="#id1">Problems when running remotely</a>’ entry instead.</p>
<p>If you are unable to run or even compile CO<em>N</em>CEPT, try running in pure
Python mode by supplying the <code class="docutils literal notranslate"><span class="pre">--pure-python</span></code> flag to the <code class="docutils literal notranslate"><span class="pre">concept</span></code> script.
If this works, you are probably dealing with an erroneous compilation. Next,
remove the <code class="docutils literal notranslate"><span class="pre">--pure-python</span></code> flag and instead use <code class="docutils literal notranslate"><span class="pre">--no-optimization</span></code>. This
runs CO<em>N</em>CEPT in compiled mode, but without any optimizations.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>To force a recompilation, you must first clean the code directory. You can
do this by</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> make clean<span class="o">)</span>
</pre></div>
</div>
</div>
<p>If CO<em>N</em>CEPT is able to run without optimizations, it might be worth to
manually edit the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> and remove/alter the exact optimization(s) that
leads to trouble, allowing for successful runs without necessarily disabling
<em>all</em> optimizations with the <code class="docutils literal notranslate"><span class="pre">--no-optimization</span></code> option.</p>
<p>If you are able to start CO<em>N</em>CEPT runs, but they crash, hang, yield
obviously wrong results, or exhibit other bad behavior, it may be due to
improper installation or a code bug. To inspect the extent of the erroneous
behavior, try running the full CO<em>N</em>CEPT test suite via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./concept -t all
</pre></div>
</div>
<p>If any test is unsuccessful and you are running a stable version of
CO<em>N</em>CEPT (i.e. any release version, not ‘master’), there is most probably
a problem with your installation. You can try reinstalling CO<em>N</em>CEPT along
with all of its dependencies, perhaps using compilers different from the ones
used the first time around.</p>
<p>If all tests passes despite the observed (and reproducible!) bad behavior,
you may have found a bug. Please report this.</p>
</div>
<div class="section" id="bad-performance-when-using-multiple-processes-nodes">
<h2><a class="toc-backref" href="#id6">Bad performance when using multiple processes/nodes</a><a class="headerlink" href="#bad-performance-when-using-multiple-processes-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you are running CO<em>N</em>CEPT on a cluster and experiences a significant
drop in performance as you increase the number of processes from e.g. 1 to 2
or 2 to 4, or when using 2 nodes instead of 1 with the same total number of
processes, the problem is likely that the MPI library used is not configured
to handle the network optimally.</p>
<p>Be sure to install CO<em>N</em>CEPT with
<a class="reference internal" href="installation.html#optimal-network-performance-on-clusters"><span class="std std-ref">optimal network performance on clusters</span></a>.
If you are observing bad network behavior even so, you should try changing the
MPI executor, as described in <a class="reference internal" href="#problems-when-running-remotely"><span class="std std-ref">this</span></a>
entry.</p>
</div>
<div class="section" id="problems-when-running-remotely">
<span id="id1"></span><h2><a class="toc-backref" href="#id7">Problems when running remotely</a><a class="headerlink" href="#problems-when-running-remotely" title="Permalink to this headline">¶</a></h2>
<p>This entry is concerned with problems encountered specifically with remote
CO<em>N</em>CEPT jobs. If you have not tried out CO<em>N</em>CEPT locally, please do
this first. If you encounter problems here as well, please see the
‘<a class="reference internal" href="#crashes-or-other-bad-behavior">Crashes or other bad behavior</a>’ entry.</p>
<p>Even if CO<em>N</em>CEPT runs fine on the frontend of a cluster (i.e. when
supplying the <code class="docutils literal notranslate"><span class="pre">--local</span></code> option to the <code class="docutils literal notranslate"><span class="pre">concept</span></code> script), you may
experience weird behavior or crashes when submitting remote jobs. Typically,
this is either due to the remote nodes having different hardware architecture
from the frontend, or an improper choice of the MPI executor. Possible
solutions to both of these problems are provided below.</p>
<h4>Different hardware architecture on frontend and remote node</h4><p>If CO<em>N</em>CEPT and its dependencies have been installed from the frontend,
these have been tailored to the architecture of the frontend. If the remote
node to which you are submitting the CO<em>N</em>CEPT job has a different
architecture, things may go wrong. The easy solution is then of course to
switch to using a different remote queue/partition with nodes that have
similar architecture to the one on the frontend.</p>
<p>One might think that disabling architecture-specific compiler optimizations in
the CO<em>N</em>CEPT <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> (like <code class="docutils literal notranslate"><span class="pre">-march=native</span></code>) would help, but since
many of the dependency programs are compiled with architecture-specific flags
as well, this rarely helps. That said, it is worth submitting a remote
CO<em>N</em>CEPT job without <em>any</em> optimizations via the <code class="docutils literal notranslate"><span class="pre">--no-optimization</span></code>
option to the <code class="docutils literal notranslate"><span class="pre">concept</span></code> script, just to see what happens. Remember to clean
the code directory before running with <code class="docutils literal notranslate"><span class="pre">--no-optimization</span></code>, to force
recompilation.</p>
<p>To really ensure compatibility with the architecture of a given node,
reinstall CO<em>N</em>CEPT — including all of its dependencies — from that
node. You may either do this by ssh’ing into the node and run the installation
manually, or you may submit the installation as a remote job. Below you will
find examples of Slurm and TORQUE/PBS job scripts for installing CO<em>N</em>CEPT.
In both cases, you may wish to add loading of modules or other environment
changes, and/or make use of a preinstalled MPI library as described under
<a class="reference internal" href="installation.html"><span class="doc">Installation</span></a>. Once a CO<em>N</em>CEPT installation job has begun, you
can follow the installation process by executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tail -f &lt;install_path&gt;/install_log
</pre></div>
</div>
<div class="topic">
<p class="topic-title first">Slurm</p>
<p>To submit a remote Slurm job for installing CO<em>N</em>CEPT, save the code
below to e.g. <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">&lt;queue&gt;</span></code> with the partition in
question) and execute <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">jobscript</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="c1">#SBATCH --job-name=install_concept</span>
<span class="c1">#SBATCH --partition=&lt;queue&gt;</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --tasks-per-node=8</span>
<span class="c1">#SBATCH --mem-per-cpu=2000M</span>
<span class="c1">#SBATCH --time=12:00:00</span>
<span class="c1">#SBATCH --output=/dev/null</span>
<span class="c1">#SBATCH --error=/dev/null</span>

<span class="nv">concept_version</span><span class="o">=</span>master
<span class="nv">install_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/concept&quot;</span>

<span class="nv">make_jobs</span><span class="o">=</span><span class="s2">&quot;-j&quot;</span> bash &lt;<span class="o">(</span>wget -O- https://raw.githubusercontent.com/jmd-dk/concept/<span class="si">${</span><span class="nv">concept_version</span><span class="si">}</span>/installer<span class="o">)</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">install_path</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div class="topic">
<p class="topic-title first">TORQUE/PBS</p>
<p>To submit a remote TORQUE/PBS job for installing CO<em>N</em>CEPT, save the
code below to e.g. <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">&lt;queue&gt;</span></code> with the queue in
question) and execute <code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">jobscript</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="c1">#PBS -N install_concept</span>
<span class="c1">#PBS -q &lt;queue&gt;</span>
<span class="c1">#PBS -l nodes=1:ppn=8</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -o /dev/null</span>
<span class="c1">#PBS -e /dev/null</span>

<span class="nv">concept_version</span><span class="o">=</span>master
<span class="nv">install_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/concept&quot;</span>

<span class="nv">make_jobs</span><span class="o">=</span><span class="s2">&quot;-j&quot;</span> bash &lt;<span class="o">(</span>wget -O- https://raw.githubusercontent.com/jmd-dk/concept/<span class="si">${</span><span class="nv">concept_version</span><span class="si">}</span>/installer<span class="o">)</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">install_path</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<h4>Choosing an MPI executor</h4><p>It may help to manually choose a different remote <em>MPI executor</em>. This is the
term used for e.g. <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>/<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> in CO<em>N</em>CEPT, i.e. the
executable used to launch MPI programs.</p>
<p>To see which MPI executor is used when running remotely, check out the
<code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code> variable in the produced <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> file. To manually set
the MPI executor, overwrite the dedicated <code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code> varaible in the
<code class="docutils literal notranslate"><span class="pre">.env</span></code> file (located one directory level above the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory,
i.e. at <code class="docutils literal notranslate"><span class="pre">/path/to/concept_installation/.env</span></code>). Helpful suggestions for the
choice of MPI executor depends on the job schedular in use.</p>
<div class="topic">
<p class="topic-title first">Using Slurm</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if you are using Slurm, it may be that your MPI library is not
configured appropriately for <code class="docutils literal notranslate"><span class="pre">srun</span></code> to be able to correctly launch
CO<em>N</em>CEPT jobs. In particular, if you are using an MPI library that
was installed by the <code class="docutils literal notranslate"><span class="pre">installer</span></code> script, as opposed to an MPI library
configured and installed by the system administrator of the cluster,
<code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> is probably your best choice.</p>
</div>
<p>If Slurm is used as the job schedular, the MPI executor will be set to
<code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--cpu_bind=none</span></code> by default. The first thing to try is to leave
out the <code class="docutils literal notranslate"><span class="pre">--cpu_bind=none</span></code>, i.e. setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;srun&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Submit a new job, and you should see the manually chosen MPI
executor being respected by the <code class="docutils literal notranslate"><span class="pre">jobscript</span></code>.</p>
<p>If that did not fix the issue, try specyfing the MPI implementation in use,
using the <code class="docutils literal notranslate"><span class="pre">--mpi</span></code> option to <code class="docutils literal notranslate"><span class="pre">srun</span></code>. E.g. for OpenMPI, set</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;srun --mpi=openmpi&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. To see which MPI implementations <code class="docutils literal notranslate"><span class="pre">srun</span></code> supports,
run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun --mpi<span class="o">=</span>list
</pre></div>
</div>
<p>You may wish to try your luck on all supported MPI implementations. If you
find one that works, do remember to test if it also works with the added
<code class="docutils literal notranslate"><span class="pre">--cpu_bind=none</span></code> option, as this is preferred.</p>
<p>If you are still unable to run remotely, you can try using <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> or
<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> for the MPI executor, as one would do when using TORQUE/PBS.</p>
</div>
<div class="topic">
<p class="topic-title first">Using TORQUE/PBS</p>
<p>When TORQUE or PBS is used as the job schedular, the MPI executor will be
set to one of <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> or <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> by default, possibly with
additional options. The first thing to try is to leave out these options,
i.e. setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;mpiexec&quot;</span>  <span class="c1"># or &quot;mpirun&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Note that CO<em>N</em>CEPT sets the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> so that
<code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>/<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> are guaranteed to be those belonging to the correct
MPI implementation (that specified in the <code class="docutils literal notranslate"><span class="pre">.paths</span></code> file). You are however
welcome to specify absolute paths as well.</p>
<p>If remote jobs still fail, you may look for other possible MPI executors,
e.g. by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> ls <span class="s2">&quot;</span><span class="si">${</span><span class="nv">mpi_bindir</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>(other possible MPI executors include <code class="docutils literal notranslate"><span class="pre">mpiexec.hydra</span></code> and <code class="docutils literal notranslate"><span class="pre">orterun</span></code>).</p>
</div>
<h4>It <em>still</em> does not work!</h4><p>If you are still struggling, it is possible that the cluster configuration
just do not play nicely with the current MPI implementation in use. If you
installed CO<em>N</em>CEPT using one of the MPI implementations present on the
cluster, try again, using another preinstalled MPI library. If you let
CO<em>N</em>CEPT install its own MPI, try switching from MPICH to OpenMPI or
vice versa (i.e. set <code class="docutils literal notranslate"><span class="pre">mpi=openmpi</span></code> or <code class="docutils literal notranslate"><span class="pre">mpi=mpich</span></code> when installing
CO<em>N</em>CEPT, as described <a class="reference internal" href="installation.html#influential-environment-variables"><span class="std std-ref">here</span></a>).</p>
<p>When installing CO<em>N</em>CEPT, try having as few modules loaded as possible,
to minimize the possibilities of wrong MPI identification and linking.</p>
</div>
<div class="section" id="problems-when-using-multiple-nodes">
<span id="id2"></span><h2><a class="toc-backref" href="#id8">Problems when using multiple nodes</a><a class="headerlink" href="#problems-when-using-multiple-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you observe a wrong process binding (i.e. it appears as though several
copies of CO<em>N</em>CEPT are running on top of each other, rather than all of
the MPI processes working together as a collective) when running CO<em>N</em>CEPT
across multiple nodes, you should try changing the MPI executor. See “choosing
an MPI executor” under <a class="reference internal" href="#problems-when-running-remotely"><span class="std std-ref">this</span></a> entry.</p>
<p>If you are able to run single-node CO<em>N</em>CEPT jobs remotely, but encounter
problems as soon as you request multiple nodes, it may be a permission
problem. For example, OpenMPI uses ssh to establish the connection between the
nodes, and so your local <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> directory need to be configured properly.
Note that when using an MPI implementation preinstalled on the cluster, such
additional configuration from the user ought not to be necessary.</p>
<p>CO<em>N</em>CEPT comes with the ability to set up the <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> as needed for
multi-node communication. Currently this feature resides as part of the
<code class="docutils literal notranslate"><span class="pre">installer</span></code> script. To apply it, from the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory, execute</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>../installer --fix-ssh
</pre></div>
</div>
<p>Note that this will move all existing content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> to
<code class="docutils literal notranslate"><span class="pre">~/.ssh_backup</span></code>. Also, any configuration you might have done will not be
reflected in the new content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>. If this indeed fixes the
multi-node problem and you want to preserve your original ssh configuration,
you must properly merge the original content of <code class="docutils literal notranslate"><span class="pre">~/.ssh_backup</span></code> back in with
the new content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      

      
      

      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>