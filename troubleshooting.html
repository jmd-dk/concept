

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Troubleshooting &mdash; CONCEPT Documentation</title>
  

  
  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
  
  
  
    <link rel="canonical" href="https://jmd-dk.github.io/concept/troubleshooting.html"/>
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.js"></script>
        <script src="_static/sphinx_tabs/tabs.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_tabs/tabs.css" type="text/css" />
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Publications" href="publications.html" />
    <link rel="prev" title="Looking under the hood" href="under_the_hood.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> CO<em>N</em>CEPT
          

          
            
            <img src="_static/logo.png" class="logo" alt="Logo"/>
          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorial/tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="tutorial/installation.html">1. Effortless installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/first_simulations.html">2. Your first simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/parameter_files.html">3. Working with parameter files</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/gravity.html">4. Mastering gravity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/gravity.html#the-pm-method">4.1. The PM method</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/gravity.html#the-p3m-method">4.2. The P³M method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/output_types.html">5. Other kinds of output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#d-renders">5.1. 3D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#id1">5.2. 2D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/output_types.html#snapshots">5.3. Snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/working_remotely.html">6. Working on remote clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/beyond_matter_only.html">7. Beyond matter-only simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#radiation">7.1. Radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#massive-neutrinos">7.2. Massive neutrinos</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#dynamical-dark-energy">7.3. Dynamical dark energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#decaying-cold-dark-matter">7.4. Decaying cold dark matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/beyond_matter_only.html#non-linear-massive-neutrinos">7.5. Non-linear massive neutrinos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="tutorial/utilities.html">8. Using utilities</a><ul>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-powerspec-and-render-utilities">8.1. The powerspec and render utilities</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-class-utility">8.2. The CLASS utility</a></li>
<li class="toctree-l3"><a class="reference internal" href="tutorial/utilities.html#the-update-utility">8.3. The update utility</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="installation.html#supported-platforms">Supported platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#standard-installation">Standard installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#optimal-network-performance-on-clusters">Optimal network performance on clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#cloning-with-git">Cloning with Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#the-installer-script-in-depth">The <code class="docutils literal notranslate"><span class="pre">installer</span></code> script in-depth</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#programs-installed">Programs installed</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#command-line-options">Command-line options</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#influential-environment-variables">Influential environment variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="installation.html#making-use-of-pre-installed-libraries">Making use of pre-installed libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#specifying-dependency-versions">Specifying dependency versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#choosing-compiler-precedence">Choosing compiler precedence</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#installing-mpich-or-openmpi">Installing MPICH or OpenMPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#parallel-builds">Parallel builds</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#using-the-installer-to-install-specific-libraries-but-not-concept-itself">Using the <code class="docutils literal notranslate"><span class="pre">installer</span></code> to install specific libraries but not CO<em>N</em>CEPT itself</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#python-dependencies">Python dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#other-primary-dependencies">Other primary dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#system-dependencies">System dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="installation.html#the-paths-and-env-files">The <code class="docutils literal notranslate"><span class="pre">.paths</span></code> and <code class="docutils literal notranslate"><span class="pre">.env</span></code> files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="installation.html#the-paths-file">The <code class="docutils literal notranslate"><span class="pre">.paths</span></code> file</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html#the-env-file">The <code class="docutils literal notranslate"><span class="pre">.env</span></code> file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="installation.html#path-like-environment-variables"><code class="docutils literal notranslate"><span class="pre">PATH</span></code>-like environment variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#eliminating-interference-from-foreign-python-installations">Eliminating interference from foreign Python installations</a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#the-mpi-executor">The <code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="installation.html#the-make-jobs-environment-variable">The <code class="docutils literal notranslate"><span class="pre">make_jobs</span></code> environment variable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="command_line_options.html">Command-line options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#basics">Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#help-h-help">Help: <code class="docutils literal notranslate"><span class="pre">-h</span></code>, <code class="docutils literal notranslate"><span class="pre">--help</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#parameter-file-p-params">Parameter file: <code class="docutils literal notranslate"><span class="pre">-p</span></code>, <code class="docutils literal notranslate"><span class="pre">--params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#command-line-parameters-c-command-line-params">Command-line parameters: <code class="docutils literal notranslate"><span class="pre">-c</span></code>, <code class="docutils literal notranslate"><span class="pre">--command-line-params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#number-of-processes-n-nprocs">Number of processes: <code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--nprocs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="command_line_options.html#specifying-multiple-nodes">Specifying multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#utility-u-utility">Utility: <code class="docutils literal notranslate"><span class="pre">-u</span></code>, <code class="docutils literal notranslate"><span class="pre">--utility</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#version-v-version">Version: <code class="docutils literal notranslate"><span class="pre">-v</span></code>, <code class="docutils literal notranslate"><span class="pre">--version</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#remote-job-submission">Remote job submission</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#queue-q-queue">Queue: <code class="docutils literal notranslate"><span class="pre">-q</span></code>, <code class="docutils literal notranslate"><span class="pre">--queue</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#wall-time-w-wall-time">Wall time: <code class="docutils literal notranslate"><span class="pre">-w</span></code>, <code class="docutils literal notranslate"><span class="pre">--wall-time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#memory-memory">Memory: <code class="docutils literal notranslate"><span class="pre">--memory</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#job-directive-j-job-directive">Job directive: <code class="docutils literal notranslate"><span class="pre">-j</span></code>, <code class="docutils literal notranslate"><span class="pre">--job-directive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#no-watching-no-watching">No watching: <code class="docutils literal notranslate"><span class="pre">--no-watching</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#other-modes-of-building-running">Other modes of building/running</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#local-local">Local: <code class="docutils literal notranslate"><span class="pre">--local</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#pure-python-pure-python">Pure Python: <code class="docutils literal notranslate"><span class="pre">--pure-python</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#no-optimizations-no-optimizations">No optimizations: <code class="docutils literal notranslate"><span class="pre">--no-optimizations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#native-optimizations-native-optimizations">Native optimizations: <code class="docutils literal notranslate"><span class="pre">--native-optimizations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#no-recompilation-no-recompilation">No recompilation: <code class="docutils literal notranslate"><span class="pre">--no-recompilation</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#unsafe-building-unsafe-building">Unsafe building: <code class="docutils literal notranslate"><span class="pre">--unsafe-building</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="command_line_options.html#specials">Specials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#test-t-test">Test: <code class="docutils literal notranslate"><span class="pre">-t</span></code>, <code class="docutils literal notranslate"><span class="pre">--test</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#main-entry-point-m-main">Main entry point: <code class="docutils literal notranslate"><span class="pre">-m</span></code>, <code class="docutils literal notranslate"><span class="pre">--main</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="command_line_options.html#interactive-i-interactive">Interactive: <code class="docutils literal notranslate"><span class="pre">-i</span></code>, <code class="docutils literal notranslate"><span class="pre">--interactive</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="parameters/parameters.html">Parameters</a><ul>
<li class="toctree-l2"><a class="reference internal" href="parameters/input_output.html">Input/output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/input_output.html#initial-conditions"><code class="docutils literal notranslate"><span class="pre">initial_conditions</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="parameters/input_output.html#snapshot-type"><code class="docutils literal notranslate"><span class="pre">snapshot_type</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/numerical_parameters.html">Numerical parameters</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/numerical_parameters.html#boxsize"><code class="docutils literal notranslate"><span class="pre">boxsize</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/cosmology.html">Cosmology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/cosmology.html#class-params"><code class="docutils literal notranslate"><span class="pre">class_params</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/physics.html">Physics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/physics.html#select-forces"><code class="docutils literal notranslate"><span class="pre">select_forces</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/simulation_options.html">Simulation options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/simulation_options.html#t-base-background-factor"><code class="docutils literal notranslate"><span class="pre">Δt_base_background_factor</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/graphics.html">Graphics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/graphics.html#terminal-width"><code class="docutils literal notranslate"><span class="pre">terminal_width</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/system_of_units.html">System of units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/system_of_units.html#unit-length"><code class="docutils literal notranslate"><span class="pre">unit_length</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="parameters/debugging_options.html">Debugging options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="parameters/debugging_options.html#print-load-imbalance"><code class="docutils literal notranslate"><span class="pre">print_load_imbalance</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="utilities/utilities.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="utilities/class.html">The CLASS utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/convert.html">The convert utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/gadget.html">The gadget utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/info.html">The info utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/play.html">The play utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/powerspec.html">The powerspec utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/render2D.html">The render2D utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/render3D.html">The render3D utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/update.html">The update utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="utilities/watch.html">The watch utility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="under_the_hood.html">Looking under the hood</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#installation-failed">Installation failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compilation-failed">Compilation failed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#insufficient-memory">Insufficient memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dangerous-optimizations">Dangerous optimizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#terminal-color-output-looks-weird">Terminal color output looks weird</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-related-to-python-libraries-and-packages">Problems related to Python libraries and packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="#error-messages-containing-read-1">Error messages containing ‘Read -1’</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-simulation-hangs-when-calling-class">The simulation hangs when calling CLASS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#crashes-or-other-bad-behavior">Crashes or other bad behavior</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-when-running-remotely">Problems when running remotely</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#choosing-an-mpi-executor">Choosing an MPI executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="#different-hardware-architecture-on-front-end-and-remote-node">Different hardware architecture on front-end and remote node</a></li>
<li class="toctree-l3"><a class="reference internal" href="#it-still-does-not-work">It <em>still</em> does not work!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bad-performance-when-using-multiple-processes-nodes">Bad performance when using multiple processes/nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="#problems-when-using-multiple-nodes">Problems when using multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="publications.html">Publications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="publications.html#theses">Theses</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CO<em>N</em>CEPT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content style-external-links">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Troubleshooting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/jmd-dk/concept/" class="fa fa-github"> Code Repository</a>
            
          
        
      </li>
    
  </ul>

  
  <div class="rst-breadcrumbs-buttons" role="navigation" aria-label="breadcrumb navigation">
      

      
      

      
  </div>
  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>This page contains solutions to and helpful information about possible issues
encountered when using CO<em>N</em>CEPT. If help from this page is insufficient
to solve your problem, do not hesitate to
<a class="reference external" href="https://github.com/jmd-dk/concept/issues">open an issue</a> or contact the
author at
<span class="raw-html"><td class="field-body"><a class="reference external" href="mailto:dakin&#37;&#52;&#48;phys&#46;au&#46;dk">dakin<span>&#64;</span>phys<span>&#46;</span>au<span>&#46;</span>dk</a></td></span>.</p>
<p>Entries on this page:</p>
<div class="contents local topic" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#installation-failed" id="id5">Installation failed</a></p></li>
<li><p><a class="reference internal" href="#compilation-failed" id="id6">Compilation failed</a></p></li>
<li><p><a class="reference internal" href="#terminal-color-output-looks-weird" id="id7">Terminal color output looks weird</a></p></li>
<li><p><a class="reference internal" href="#problems-related-to-python-libraries-and-packages" id="id8">Problems related to Python libraries and packages</a></p></li>
<li><p><a class="reference internal" href="#error-messages-containing-read-1" id="id9">Error messages containing ‘Read -1’</a></p></li>
<li><p><a class="reference internal" href="#the-simulation-hangs-when-calling-class" id="id10">The simulation hangs when calling CLASS</a></p></li>
<li><p><a class="reference internal" href="#crashes-or-other-bad-behavior" id="id11">Crashes or other bad behavior</a></p></li>
<li><p><a class="reference internal" href="#problems-when-running-remotely" id="id12">Problems when running remotely</a></p></li>
<li><p><a class="reference internal" href="#bad-performance-when-using-multiple-processes-nodes" id="id13">Bad performance when using multiple processes/nodes</a></p></li>
<li><p><a class="reference internal" href="#problems-when-using-multiple-nodes" id="id14">Problems when using multiple nodes</a></p></li>
</ul>
</div>
<div class="section" id="installation-failed">
<h2><a class="toc-backref" href="#id5">Installation failed</a><a class="headerlink" href="#installation-failed" title="Permalink to this headline">¶</a></h2>
<p>We strive for a trivial installation process on as many Linux systems as
possible. If the
<a class="reference internal" href="installation.html#standard-installation"><span class="std std-ref">standard installation process</span></a>
(with every dependency allowed to be installed from scratch) keeps failing
for some inexplicable reason, you may try looking for a clue in the logged
installation output (of which there are a lot), in the <code class="docutils literal notranslate"><span class="pre">install_log</span></code> and
<code class="docutils literal notranslate"><span class="pre">install_log_err</span></code> files.</p>
<p>One possible source of trouble is corrupted downloads. The <code class="docutils literal notranslate"><span class="pre">installer</span></code>
script downloads the source code of every primary dependency into a directory
named <code class="docutils literal notranslate"><span class="pre">tmp</span></code>. If you suspect a corrupt download, you can try deleting this
entire directory, which will trigger re-downloads.</p>
<p>It may happen that some dependency program fails to install due to some other
dependency not working correctly. You may try adding the <code class="docutils literal notranslate"><span class="pre">--test</span></code> option
when invoking the <code class="docutils literal notranslate"><span class="pre">installer</span></code>, which test most of the dependency programs
after/during their individual installation. Carefully looking through the
installation log files for failed tests may then reveal something.</p>
</div>
<div class="section" id="compilation-failed">
<h2><a class="toc-backref" href="#id6">Compilation failed</a><a class="headerlink" href="#compilation-failed" title="Permalink to this headline">¶</a></h2>
<p>Compilation of the CO<em>N</em>CPET code takes place as the last essential step
during <a class="reference internal" href="installation.html#standard-installation"><span class="std std-ref">standard installation</span></a>, as well as when
invoking <code class="docutils literal notranslate"><span class="pre">concept</span></code> after changes have been made to the source files. This
process may fail for several reasons, solutions to some are described in this
entry.</p>
<p>To check whether the problem is confined to the compilation process, run the
code in pure Python mode. From within the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory, do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./concept --pure-python --local
</pre></div>
</div>
<p>If this simple invocation of <code class="docutils literal notranslate"><span class="pre">concept</span></code> fails, the problem is not with the
compilation process itself, in which case this troubleshooting entry cannot
help you.</p>
<div class="section" id="insufficient-memory">
<span id="id1"></span><h3>Insufficient memory<a class="headerlink" href="#insufficient-memory" title="Permalink to this headline">¶</a></h3>
<p>The minimum memory needed in order for compilation of the code to succeed is
about 5 GB, though the exact number depends on the system. If you suspect the
cause of compilation errors might be insufficient memory, try out the below
steps from within the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory. Before attempting each step, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> make clean<span class="o">)</span>
</pre></div>
</div>
<p>in order to clean up from the last, failed compilation attempt.</p>
<ul>
<li><p>Standard (parallel) compilation:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./concept --local
</pre></div>
</div>
</li>
<li><p>Compile each module in serial:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">make_jobs</span><span class="o">=</span><span class="s2">&quot;-j 1&quot;</span> ./concept --local
</pre></div>
</div>
</li>
<li><p>Add extra swap memory: If you have root privileges on the system, you can
temporarily increase the available memory by adding a swap file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">n</span><span class="o">=</span><span class="m">8</span>
sudo dd <span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>swapfile <span class="nv">bs</span><span class="o">=</span><span class="m">1024</span> <span class="nv">count</span><span class="o">=</span><span class="k">$((</span>n*2**20<span class="k">))</span>
sudo chmod <span class="m">600</span> swapfile
sudo mkswap swapfile
sudo swapon swapfile
</pre></div>
</div>
<p>This will add an additional 8 GB of swap memory (taken from available disk
space), which is plenty. If you do not have that much free disk space, you
may try with a lower value of <code class="docutils literal notranslate"><span class="pre">n</span></code>. With this increased amount of memory,
try compiling the code again. If it still fails even when compiling
serially, memory is not the problem. To clean up the swap file, do</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo swapoff swapfile
sudo rm -f swapfile
</pre></div>
</div>
</li>
</ul>
<p>After successful compilation, CO<em>N</em>CEPT will run just as performant as had
the compilation taken place without trouble.</p>
</div>
<div class="section" id="dangerous-optimizations">
<span id="id2"></span><h3>Dangerous optimizations<a class="headerlink" href="#dangerous-optimizations" title="Permalink to this headline">¶</a></h3>
<p>If the compilation errors were not due to
<a class="reference internal" href="#insufficient-memory"><span class="std std-ref">insufficient memory</span></a>, it may be that one or more
of the applied optimization flags causes trouble. Try compiling without any
optimizations:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> make clean<span class="o">)</span>  <span class="c1"># cleanup</span>
./concept --no-optimizations --local
</pre></div>
</div>
<p>If this works, the problem is definately with some of the optimization flags.
You should however not run CO<em>N</em>CEPT simulations with the compiled code in
a completely unoptimized state, as this reduces performance drastically.
Instead, experiment with removing individual optimization flags added to the
<code class="docutils literal notranslate"><span class="pre">optimizations</span></code> variable within the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code>. Substitute the <code class="docutils literal notranslate"><span class="pre">-O3</span></code>
flag with <code class="docutils literal notranslate"><span class="pre">-O2</span></code>, then <code class="docutils literal notranslate"><span class="pre">-O1</span></code>, then <code class="docutils literal notranslate"><span class="pre">-O0</span></code>, before removing it completely.
For each attempt, recompile CO<em>N</em>CEPT with<em>out</em> <code class="docutils literal notranslate"><span class="pre">--no-optimizations</span></code>.
Also, remember to clean up the old compilation before attempting anew.</p>
</div>
</div>
<div class="section" id="terminal-color-output-looks-weird">
<h2><a class="toc-backref" href="#id7">Terminal color output looks weird</a><a class="headerlink" href="#terminal-color-output-looks-weird" title="Permalink to this headline">¶</a></h2>
<p>CO<em>N</em>CEPT includes a lot of color and other formatting in its terminal
output. While most modern terminal emulators on Linux (GNOME Terminal,
Terminator, xterm, etc.) fully support this, the story is different on other
platforms.</p>
<ul>
<li><p><strong>Windows</strong>: If you are running CO<em>N</em>CEPT through the Windows subsystem
for Linux and the terminal formatting appears suboptimal, you can install a
modern Linux terminal within the Linux subsystem. Note that this requires a
running X server on the <em>Windows</em> side.</p>
<p>If you are running CO<em>N</em>CEPT from Windows locally through Docker or
remotely via SSH (through e.g. PuTTY), no solution is known.</p>
</li>
<li><p><strong>macOS</strong>: If you are running CO<em>N</em>CEPT from macOS (locally through
Docker or remotely via SSH) and the terminal formatting appears suboptimal,
try using the superior <a class="reference external" href="https://www.iterm2.com/">iTerm2</a> terminal emulator.</p></li>
</ul>
<p>If you want to disable color and other formatted output alltogether, set</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">enable_terminal_formatting</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>in your parameter files. Note that though this eliminates most formatting,
a few elements are still formatted.</p>
</div>
<div class="section" id="problems-related-to-python-libraries-and-packages">
<h2><a class="toc-backref" href="#id8">Problems related to Python libraries and packages</a><a class="headerlink" href="#problems-related-to-python-libraries-and-packages" title="Permalink to this headline">¶</a></h2>
<p>If Python itself fails to start or raises <code class="docutils literal notranslate"><span class="pre">ImportError</span></code> when loading certain
packages, it may be due to improper configuration of the Python environment.
In particular the <code class="docutils literal notranslate"><span class="pre">PYTHONPATH</span></code>, <code class="docutils literal notranslate"><span class="pre">PYTHONHOME</span></code> and <code class="docutils literal notranslate"><span class="pre">PYTHONNOUSERSITE</span></code>
environment variables should be set (or unset) appropriately. If CO<em>N</em>CEPT
has its own dedicated Python installation, one safe choice is to follow
<a class="reference internal" href="installation.html#eliminating-interference-from-foreign-python-installations"><span class="std std-ref">this</span></a>,
which isolate the dedicated Python installation so that other Python
installations on the system has no chance of interfering.</p>
<p>Note that if you have installed CO<em>N</em>CEPT using the <code class="docutils literal notranslate"><span class="pre">installer</span></code> and not
explicitly made use of a pre-existing Python installation, a dedicated Python
has been installation and the Python environment has already been set up
appropriately (see the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file).</p>
</div>
<div class="section" id="error-messages-containing-read-1">
<h2><a class="toc-backref" href="#id9">Error messages containing ‘Read -1’</a><a class="headerlink" href="#error-messages-containing-read-1" title="Permalink to this headline">¶</a></h2>
<p>If you see error messages of the format</p>
<blockquote>
<div><p>Read -1, expected &lt;int&gt;, errno = &lt;int&gt;</p>
</div></blockquote>
<p>whenever you run CO<em>N</em>CEPT using more than a single process, it is likely
a problem with OpenMPI, more specifically vader/CMA. If CO<em>N</em>CEPT
otherwise produces correct results, you can silence these messages by placing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">export</span> <span class="nv">OMPI_MCA_btl_vader_single_copy_mechanism</span><span class="o">=</span>none
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file (located one directory level above the <code class="docutils literal notranslate"><span class="pre">concept</span></code>
directory, i.e. at <code class="docutils literal notranslate"><span class="pre">/path/to/concept_installation/.env</span></code>) of your
CO<em>N</em>CEPT installation.</p>
</div>
<div class="section" id="the-simulation-hangs-when-calling-class">
<h2><a class="toc-backref" href="#id10">The simulation hangs when calling CLASS</a><a class="headerlink" href="#the-simulation-hangs-when-calling-class" title="Permalink to this headline">¶</a></h2>
<p>If the simulation hangs right at the beginning of the simulation, at the</p>
<blockquote>
<div><p>Calling CLASS in order to set the cosmic clock …</p>
</div></blockquote>
<p>step, it is probably because you have specified a cosmology that CLASS cannot
handle. When running CO<em>N</em>CEPT in compiled mode, CLASS may hang rather
than exiting with an error message. To see the CLASS error message, run
CO<em>N</em>CEPT in pure Python mode using the <code class="docutils literal notranslate"><span class="pre">--pure-python</span></code>
<a class="reference internal" href="command_line_options.html#pure-python"><span class="std std-ref">command-line option</span></a>.</p>
</div>
<div class="section" id="crashes-or-other-bad-behavior">
<h2><a class="toc-backref" href="#id11">Crashes or other bad behavior</a><a class="headerlink" href="#crashes-or-other-bad-behavior" title="Permalink to this headline">¶</a></h2>
<p>This entry is concerned with problems encountered when using CO<em>N</em>CEPT
<em>locally</em>. If your problem occurs only for remote jobs, please see the
‘<a class="reference internal" href="#id3">Problems when running remotely</a>’ entry instead.</p>
<p>If you are unable to even compile CO<em>N</em>CEPT, see the
‘<a class="reference internal" href="#compilation-failed">Compilation failed</a>’ entry.</p>
<p>If you are able to start CO<em>N</em>CEPT runs, but they crash, hang, yield
obviously wrong results, or exhibit other bad behavior, it may be due to
improper installation or a code bug. To inspect the extent of the erroneous
behavior, try running the full CO<em>N</em>CEPT test suite via</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./concept -t all
</pre></div>
</div>
<p>If any tests are unsuccessful and you are running a stable version of
CO<em>N</em>CEPT (i.e. any release version, not ‘master’), there is most probably
a problem with your installation. You can try reinstalling CO<em>N</em>CEPT along
with all of its dependencies, perhaps using compilers different from the ones
used the first time around.</p>
<p>If all tests passes despite the observed (and reproducible!) bad behavior,
you may have found a bug. Please report this.</p>
</div>
<div class="section" id="problems-when-running-remotely">
<span id="id3"></span><h2><a class="toc-backref" href="#id12">Problems when running remotely</a><a class="headerlink" href="#problems-when-running-remotely" title="Permalink to this headline">¶</a></h2>
<p>This entry is concerned with problems encountered specifically with remote
CO<em>N</em>CEPT jobs. If you have not tried out CO<em>N</em>CEPT locally, please do
this first. If you encounter problems here as well, please see the
‘<a class="reference internal" href="#crashes-or-other-bad-behavior">Crashes or other bad behavior</a>’ entry.</p>
<p>Even if CO<em>N</em>CEPT runs fine on the front-end of a cluster (i.e. when
supplying the <code class="docutils literal notranslate"><span class="pre">--local</span></code> option to the <code class="docutils literal notranslate"><span class="pre">concept</span></code> script), you may
experience weird behavior or crashes when running remote jobs. Typically this
is either due to an improper choice of the MPI executor, or the remote nodes
having different hardware architecture from the front-end. Possible solutions
to both of these problems are provided below.</p>
<div class="section" id="choosing-an-mpi-executor">
<span id="chosing-an-mpi-executor"></span><h3>Choosing an MPI executor<a class="headerlink" href="#choosing-an-mpi-executor" title="Permalink to this headline">¶</a></h3>
<p>It may help to manually choose a different remote <em>MPI executor</em>. This is the
term used for e.g. <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>/<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> in CO<em>N</em>CEPT, i.e. the
executable used to launch MPI programs.</p>
<p>To see which MPI executor is used when running remotely, check out the
<code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code> variable in the produced <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> file. To manually set
the MPI executor, overwrite the dedicated <code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code> varaible in the
<code class="docutils literal notranslate"><span class="pre">.env</span></code> file (located one directory level above the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory,
i.e. at <code class="docutils literal notranslate"><span class="pre">/path/to/concept_installation/.env</span></code>). Helpful suggestions for the
choice of MPI executor depends on the job scheduler in use (Slurm or
TORQUE/PBS).</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U2x1cm0= docutils container">
<div class="docutils container">
<p>Slurm</p>
</div>
</div>
<div class="item sphinx-data-tab-VE9SUVVFL1BCUw== docutils container">
<div class="docutils container">
<p>TORQUE/PBS</p>
</div>
</div>
</div>
<div style="padding-bottom: 0;" class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-U2x1cm0= active docutils container">
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Even if you are using Slurm, it may be that your MPI library is not
configured appropriately for <code class="docutils literal notranslate"><span class="pre">srun</span></code> to be able to correctly launch
MPI jobs. This can happen e.g. if you are using an MPI library that
was installed by the CO<em>N</em>CEPT <code class="docutils literal notranslate"><span class="pre">installer</span></code> script, as opposed
to an MPI library configured and installed by a system administrator
of the cluster. If the below does not work, try setting the MPI
executor as though you were using TORQUE/PBS.</p>
</div>
<p>If Slurm is used as the job scheduler and the MPI library used was not
installed by the <code class="docutils literal notranslate"><span class="pre">installer</span></code> script as part of the CO<em>N</em>CEPT
installation, the MPI executor will be set to <code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--cpu_bind=none</span></code>
in job scripts by default (or possibly
<code class="docutils literal notranslate"><span class="pre">srun</span> <span class="pre">--cpu_bind=none</span> <span class="pre">--mpi=openmpi</span></code> if OpenMPI is used). The first
thing to try is to leave out <code class="docutils literal notranslate"><span class="pre">--cpu_bind=none</span></code>, i.e. setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;srun&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Submit a new job, and you should see the manually
chosen MPI executor being respected by the <code class="docutils literal notranslate"><span class="pre">jobscript</span></code>.</p>
<p>If that did not fix the issue, try specyfing the MPI implementation in
use, using the <code class="docutils literal notranslate"><span class="pre">--mpi</span></code> option to <code class="docutils literal notranslate"><span class="pre">srun</span></code>. E.g. for OpenMPI, set</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;srun --mpi=openmpi&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. To see which MPI implementations <code class="docutils literal notranslate"><span class="pre">srun</span></code>
supports, run</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>srun --mpi<span class="o">=</span>list
</pre></div>
</div>
<p>directly on the front-end. You may wish to try your luck on all
supported MPI implementations. If you find one that works, do remember
to test if it also works with the added <code class="docutils literal notranslate"><span class="pre">--cpu_bind=none</span></code> option, as
this is preferred.</p>
</div>
<div style="padding-bottom: 0;" class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-VE9SUVVFL1BCUw== docutils container">
<p>When TORQUE or PBS is used as the job scheduler, the MPI executor will be
set to one of <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code> or <code class="docutils literal notranslate"><span class="pre">mpirun</span></code> by default, possibly with
additional options. The first thing to try is to leave out these options,
i.e. setting</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;mpiexec&quot;</span>  <span class="c1"># or &quot;mpirun&quot;</span>
</pre></div>
</div>
<p>in the <code class="docutils literal notranslate"><span class="pre">.env</span></code> file. Note that CO<em>N</em>CEPT sets the <code class="docutils literal notranslate"><span class="pre">PATH</span></code> so that
<code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>/<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> are guaranteed to be those belonging to the
correct MPI implementation (that specified in the <code class="docutils literal notranslate"><span class="pre">.paths</span></code> file). You
are however allowed to specify absolute paths as well.</p>
<p>Options to try out with <code class="docutils literal notranslate"><span class="pre">mpiexec</span></code>/<code class="docutils literal notranslate"><span class="pre">mpirun</span></code> include</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;mpiexec --bind-to none&quot;</span>  <span class="c1"># or &quot;mpirun --bind-to none&quot;</span>
</pre></div>
</div>
<p>and</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">mpi_executor</span><span class="o">=</span><span class="s2">&quot;mpiexec -bind-to none&quot;</span>  <span class="c1"># or &quot;mpirun -bind-to none&quot;</span>
</pre></div>
</div>
<p>(the difference being one or two dashes before <code class="docutils literal notranslate"><span class="pre">bind</span></code>).</p>
<p>If remote jobs still fail, you may look for other possible MPI executors,
e.g. by running</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> ls <span class="s2">&quot;</span><span class="si">${</span><span class="nv">mpi_bindir</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span>
</pre></div>
</div>
<p>(other possible MPI executors include <code class="docutils literal notranslate"><span class="pre">mpiexec.hydra</span></code> and <code class="docutils literal notranslate"><span class="pre">orterun</span></code>).</p>
</div>
</div>
</div>
<div class="section" id="different-hardware-architecture-on-front-end-and-remote-node">
<h3>Different hardware architecture on front-end and remote node<a class="headerlink" href="#different-hardware-architecture-on-front-end-and-remote-node" title="Permalink to this headline">¶</a></h3>
<p>If CO<em>N</em>CEPT and its dependencies have been installed from the front-end,
these have been somewhat tailored to the architecture of the front-end. If the
remote node to which you are submitting the CO<em>N</em>CEPT job has a different
architecture, things may go wrong. The easy solution is then of course to
switch to using a different remote queue/partition with nodes that have
similar architecture to that of the front-end.</p>
<p>If you have installed CO<em>N</em>CEPT using the
<a class="reference internal" href="installation.html#standard-installation"><span class="std std-ref">standard installation process</span></a>, CO<em>N</em>CEPT
itself and all of its dependencies have been built in a somewhat portable
manner, meaning that CO<em>N</em>CEPT should run fine on architectures different
from that on the front-end, as long as its not <em>too</em> different.</p>
<p>The above portability is broken if you have built CO<em>N</em>CEPT using the
<code class="docutils literal notranslate"><span class="pre">--native-optimizations</span></code> option. To rebuild the code without additional
non-portable optimizations (default build), do (from the <code class="docutils literal notranslate"><span class="pre">concept</span></code>
directory)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="o">(</span><span class="nb">source</span> concept <span class="o">&amp;&amp;</span> make clean<span class="o">)</span>  <span class="c1"># cleanup</span>
./concept --local               <span class="c1"># rebuild</span>
</pre></div>
</div>
<p>If rebuilding the code with only portable optimizations did not fix the
problem, it is worth submitting a remote CO<em>N</em>CEPT job without <em>any</em>
optimizations via the <code class="docutils literal notranslate"><span class="pre">--no-optimizations</span></code> option to the <code class="docutils literal notranslate"><span class="pre">concept</span></code> script,
just to see what happens. Remember to clean the code directory before running
with <code class="docutils literal notranslate"><span class="pre">--no-optimizations</span></code>, to force recompilation. If this works, you should
experiment with the <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> as described
<a class="reference internal" href="#dangerous-optimizations"><span class="std std-ref">here</span></a>, as running in a completely unoptimized
state is far from ideal.</p>
<p>To really ensure compatibility with the architecture of a given node,
reinstall CO<em>N</em>CEPT — including all of its dependencies — from that
node. You may either do this by <code class="docutils literal notranslate"><span class="pre">ssh</span></code>’ing into the node and run the
installation manually, or you may submit the installation as a remote job.
Below you will find examples of Slurm and TORQUE/PBS job scripts for
installing CO<em>N</em>CEPT. In both cases you may wish to change
<code class="docutils literal notranslate"><span class="pre">concept_version</span></code> and <code class="docutils literal notranslate"><span class="pre">install_path</span></code>, load modules or perform other
environment changes, and/or make use of a pre-installed MPI library as
described <a class="reference internal" href="installation.html#optimal-network-performance-on-clusters"><span class="std std-ref">here</span></a>.</p>
<div class="sphinx-tabs docutils container">
<div class="ui top attached tabular menu sphinx-menu docutils container">
<div class="active item sphinx-data-tab-U2x1cm0= docutils container">
<div class="docutils container">
<p>Slurm</p>
</div>
</div>
<div class="item sphinx-data-tab-VE9SUVVFL1BCUw== docutils container">
<div class="docutils container">
<p>TORQUE/PBS</p>
</div>
</div>
</div>
<div style="padding-bottom: 0;" class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-U2x1cm0= active docutils container">
<p>To submit a remote Slurm job for installing CO<em>N</em>CEPT, save the code
below to e.g. <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">&lt;queue&gt;</span></code> with the partition in
question) and execute <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">jobscript</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="c1">#SBATCH --job-name=install_concept</span>
<span class="c1">#SBATCH --partition=&lt;queue&gt;</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --tasks-per-node=8</span>
<span class="c1">#SBATCH --mem-per-cpu=2000M</span>
<span class="c1">#SBATCH --time=12:00:00</span>
<span class="c1">#SBATCH --output=/dev/null</span>
<span class="c1">#SBATCH --error=/dev/null</span>

<span class="nv">concept_version</span><span class="o">=</span>master
<span class="nv">install_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/concept&quot;</span>

<span class="nv">installer</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/jmd-dk/concept/</span><span class="si">${</span><span class="nv">concept_version</span><span class="si">}</span><span class="s2">/installer&quot;</span>
<span class="nv">make_jobs</span><span class="o">=</span><span class="s2">&quot;-j&quot;</span> bash &lt;<span class="o">(</span>wget -O- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">installer</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">install_path</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
<div style="padding-bottom: 0;" class="ui bottom attached sphinx-tab tab segment sphinx-data-tab-VE9SUVVFL1BCUw== docutils container">
<p>To submit a remote TORQUE/PBS job for installing CO<em>N</em>CEPT, save the
code below to e.g. <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> (replacing <code class="docutils literal notranslate"><span class="pre">&lt;queue&gt;</span></code> with the queue
in question) and execute <code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">jobscript</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/usr/bin/env bash</span>
<span class="c1">#PBS -N install_concept</span>
<span class="c1">#PBS -q &lt;queue&gt;</span>
<span class="c1">#PBS -l nodes=1:ppn=8</span>
<span class="c1">#PBS -l walltime=12:00:00</span>
<span class="c1">#PBS -o /dev/null</span>
<span class="c1">#PBS -e /dev/null</span>

<span class="nv">concept_version</span><span class="o">=</span>master
<span class="nv">install_path</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">HOME</span><span class="si">}</span><span class="s2">/concept&quot;</span>

<span class="nv">installer</span><span class="o">=</span><span class="s2">&quot;https://raw.githubusercontent.com/jmd-dk/concept/</span><span class="si">${</span><span class="nv">concept_version</span><span class="si">}</span><span class="s2">/installer&quot;</span>
<span class="nv">make_jobs</span><span class="o">=</span><span class="s2">&quot;-j&quot;</span> bash &lt;<span class="o">(</span>wget -O- <span class="s2">&quot;</span><span class="si">${</span><span class="nv">installer</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">)</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">install_path</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>Once a CO<em>N</em>CEPT installation job has begun, you can follow the
installation process by executing</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>tail -f &lt;install_path&gt;/install_log
</pre></div>
</div>
</div>
<div class="section" id="it-still-does-not-work">
<h3>It <em>still</em> does not work!<a class="headerlink" href="#it-still-does-not-work" title="Permalink to this headline">¶</a></h3>
<p>If you are still struggling, in particular if CO<em>N</em>CEPT does launch but
the MPI process binding/affinity is wrong, try removing some of the added
environment variables that gets set in the <code class="docutils literal notranslate"><span class="pre">jobscript</span></code> (under the
‘Environment variables’ heading). After altering the job script, submit it
manually using <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">jobscript</span></code> (Slurm) or <code class="docutils literal notranslate"><span class="pre">qsub</span> <span class="pre">jobscript</span></code>
(TORQUE/PBS).</p>
<p>It is also possible that the cluster configuration just do not play nicely
with the current MPI implementation in use. If you installed CO<em>N</em>CEPT
using one of the MPI implementations present on the cluster, try again, using
another pre-installed MPI library. If you let CO<em>N</em>CEPT install its own
MPI, try switching from MPICH to OpenMPI or vice versa, as described
<a class="reference internal" href="installation.html#installing-mpich-or-openmpi"><span class="std std-ref">here</span></a>.</p>
<p>When installing CO<em>N</em>CEPT, try having as few modules loaded as possible,
in order to minimize the possibility of wrong MPI identification and linking.</p>
</div>
</div>
<div class="section" id="bad-performance-when-using-multiple-processes-nodes">
<h2><a class="toc-backref" href="#id13">Bad performance when using multiple processes/nodes</a><a class="headerlink" href="#bad-performance-when-using-multiple-processes-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you are running CO<em>N</em>CEPT on a cluster and experiences a significant
drop in performance as you increase the number of processes from e.g. 1 to 2
or 2 to 4, or when using 2 nodes instead of 1 with the same total number of
processes, the problem is likely that the MPI library used is not configured
to handle the network optimally.</p>
<p>Be sure to install CO<em>N</em>CEPT with
<a class="reference internal" href="installation.html#optimal-network-performance-on-clusters"><span class="std std-ref">optimal network performance on clusters</span></a>.
If you are observing bad network behavior even so, you should try changing the
MPI executor, as described <a class="reference internal" href="#chosing-an-mpi-executor"><span class="std std-ref">here</span></a>.</p>
</div>
<div class="section" id="problems-when-using-multiple-nodes">
<span id="id4"></span><h2><a class="toc-backref" href="#id14">Problems when using multiple nodes</a><a class="headerlink" href="#problems-when-using-multiple-nodes" title="Permalink to this headline">¶</a></h2>
<p>If you observe a wrong process binding (i.e. it appears as though several
copies of CO<em>N</em>CEPT are running on top of each other, rather than all of
the MPI processes working together as a collective) when running CO<em>N</em>CEPT
across multiple nodes, you should try
<a class="reference internal" href="#chosing-an-mpi-executor"><span class="std std-ref">changing the MPI executor</span></a>.</p>
<p>If you are able to run single-node CO<em>N</em>CEPT jobs remotely, but encounter
problems as soon as you request multiple nodes, it may be a permission
problem. For example, OpenMPI uses SSH to establish the connection between the
nodes, and so your local <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> directory need to be configured properly.
Note that when using an MPI implementation pre-installed on the cluster, such
additional configuration from the user ought not to be necessary.</p>
<p>CO<em>N</em>CEPT comes with the ability to set up the <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> as needed for
multi-node communication. Currently this feature resides as part of the
<code class="docutils literal notranslate"><span class="pre">installer</span></code> script. To apply it, from the <code class="docutils literal notranslate"><span class="pre">concept</span></code> directory, execute</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>../installer --fix-ssh
</pre></div>
</div>
<p>Note that this will move all existing content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code> to
<code class="docutils literal notranslate"><span class="pre">~/.ssh_backup</span></code>. Also, any configuration you might have done will not be
reflected in the new content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>. If this indeed fixes the
multi-node problem and you want to preserve your original SSH configuration,
you must properly merge the original content of <code class="docutils literal notranslate"><span class="pre">~/.ssh_backup</span></code> back in with
the new content of <code class="docutils literal notranslate"><span class="pre">~/.ssh</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      

      
      

      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>