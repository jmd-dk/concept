<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Numerics &mdash; CONCEPT Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/tabs.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="canonical" href="https://jmd-dk.github.io/concept/parameters/numerics.html" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../_static/jquery.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Cosmology" href="cosmology.html" />
    <link rel="prev" title="Input/output" href="input_output.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            CO<em>N</em>CEPT
              <img src="../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search documentation" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../tutorial/tutorial.html">Tutorial</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/installation.html">1. Effortless installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/first_simulations.html">2. Your first simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/parameter_files.html">3. Working with parameter files</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/gravity.html">4. Mastering gravity</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/gravity.html#the-pm-method">4.1. The PM method</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/gravity.html#the-p3m-method">4.2. The P³M method</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/output_types.html">5. Other kinds of output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/output_types.html#bispectra">5.1. Bispectra</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/output_types.html#d-renders">5.2. 3D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/output_types.html#id1">5.3. 2D renders</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/output_types.html#snapshots">5.4. Snapshots</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/working_remotely.html">6. Working on remote clusters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/beyond_matter_only.html">7. Beyond matter-only simulations</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/beyond_matter_only.html#radiation">7.1. Radiation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/beyond_matter_only.html#massive-neutrinos">7.2. Massive neutrinos</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/beyond_matter_only.html#dynamical-dark-energy">7.3. Dynamical dark energy</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/beyond_matter_only.html#decaying-cold-dark-matter">7.4. Decaying cold dark matter</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tutorial/beyond_matter_only.html#non-linear-massive-neutrinos">7.5. Non-linear massive neutrinos</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/bispectra.html">8. Bispectra and 2LPT</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/gadget.html">9. Comparison with GADGET-2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#supported-platforms">Supported platforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#standard-installation">Standard installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#optimal-network-performance-on-clusters">Optimal network performance on clusters</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#cloning-with-git">Cloning with Git</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#the-install-script-in-depth">The <code class="docutils literal notranslate"><span class="pre">install</span></code> script in-depth</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#programs-installed">Programs installed</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#command-line-options">Command-line options</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#influential-environment-variables">Influential environment variables</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#making-use-of-pre-installed-libraries">Making use of pre-installed libraries</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#specifying-dependency-versions">Specifying dependency versions</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#specifying-dependency-urls">Specifying dependency URLs</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#choosing-compiler-precedence">Choosing compiler precedence</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#installing-mpich-or-openmpi">Installing MPICH or OpenMPI</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#parallel-builds">Parallel builds</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#using-the-install-script-to-install-specific-libraries-but-not-concept-itself">Using the <code class="docutils literal notranslate"><span class="pre">install</span></code> script to install specific libraries but not CO<em>N</em>CEPT itself</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#dependencies">Dependencies</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#python-dependencies">Python dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#other-primary-dependencies">Other primary dependencies</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#system-dependencies">System dependencies</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#the-path-and-env-files">The <code class="docutils literal notranslate"><span class="pre">.path</span></code> and <code class="docutils literal notranslate"><span class="pre">.env</span></code> files</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#the-path-file">The <code class="docutils literal notranslate"><span class="pre">.path</span></code> file</a></li>
<li class="toctree-l3"><a class="reference internal" href="../installation.html#the-env-file">The <code class="docutils literal notranslate"><span class="pre">.env</span></code> file</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#path-like-environment-variables"><code class="docutils literal notranslate"><span class="pre">PATH</span></code>-like environment variables</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#eliminating-interference-from-foreign-python-installations">Eliminating interference from foreign Python installations</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#the-mpi-executor">The <code class="docutils literal notranslate"><span class="pre">mpi_executor</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation.html#the-make-jobs-environment-variable">The <code class="docutils literal notranslate"><span class="pre">make_jobs</span></code> environment variable</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../command_line_options.html">Command-line options</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../command_line_options.html#basics">Basics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#help-h-help">Help: <code class="docutils literal notranslate"><span class="pre">-h</span></code>, <code class="docutils literal notranslate"><span class="pre">--help</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#parameter-file-p-param">Parameter file: <code class="docutils literal notranslate"><span class="pre">-p</span></code>, <code class="docutils literal notranslate"><span class="pre">--param</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#command-line-parameters-c-command-line-params">Command-line parameters: <code class="docutils literal notranslate"><span class="pre">-c</span></code>, <code class="docutils literal notranslate"><span class="pre">--command-line-params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#number-of-processes-n-nprocs">Number of processes: <code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--nprocs</span></code></a><ul>
<li class="toctree-l4"><a class="reference internal" href="../command_line_options.html#specifying-multiple-nodes">Specifying multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#utility-u-utility">Utility: <code class="docutils literal notranslate"><span class="pre">-u</span></code>, <code class="docutils literal notranslate"><span class="pre">--utility</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../command_line_options.html#remote-job-submission">Remote job submission</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#submit-submit">Submit: <code class="docutils literal notranslate"><span class="pre">--submit</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#queue-q-queue">Queue: <code class="docutils literal notranslate"><span class="pre">-q</span></code>, <code class="docutils literal notranslate"><span class="pre">--queue</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#wall-time-w-walltime">Wall time: <code class="docutils literal notranslate"><span class="pre">-w</span></code>, <code class="docutils literal notranslate"><span class="pre">--walltime</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#memory-memory">Memory: <code class="docutils literal notranslate"><span class="pre">--memory</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#job-name-job-name">Job name: <code class="docutils literal notranslate"><span class="pre">--job-name</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#job-directive-j-job-directive">Job directive: <code class="docutils literal notranslate"><span class="pre">-j</span></code>, <code class="docutils literal notranslate"><span class="pre">--job-directive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#watch-watch">Watch: <code class="docutils literal notranslate"><span class="pre">--watch</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../command_line_options.html#building-and-running">Building and running</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#local-local">Local: <code class="docutils literal notranslate"><span class="pre">--local</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#pure-python-pure-python">Pure Python: <code class="docutils literal notranslate"><span class="pre">--pure-python</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#build-b-build">Build: <code class="docutils literal notranslate"><span class="pre">-b</span></code>, <code class="docutils literal notranslate"><span class="pre">--build</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#rebuild-rebuild">Rebuild: <code class="docutils literal notranslate"><span class="pre">--rebuild</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#optimizations-optimizations">Optimizations: <code class="docutils literal notranslate"><span class="pre">--optimizations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#link-time-optimizations-linktime-optimizations">Link time optimizations: <code class="docutils literal notranslate"><span class="pre">--linktime-optimizations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#native-optimizations-native-optimizations">Native optimizations: <code class="docutils literal notranslate"><span class="pre">--native-optimizations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#safe-build-safe-build">Safe build: <code class="docutils literal notranslate"><span class="pre">--safe-build</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../command_line_options.html#specials">Specials</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#test-t-tests">Test: <code class="docutils literal notranslate"><span class="pre">-t</span></code>, <code class="docutils literal notranslate"><span class="pre">--tests</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#main-entry-point-m-main">Main entry point: <code class="docutils literal notranslate"><span class="pre">-m</span></code>, <code class="docutils literal notranslate"><span class="pre">--main</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#interactive-i-interactive">Interactive: <code class="docutils literal notranslate"><span class="pre">-i</span></code>, <code class="docutils literal notranslate"><span class="pre">--interactive</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="../command_line_options.html#version-v-version">Version: <code class="docutils literal notranslate"><span class="pre">-v</span></code>, <code class="docutils literal notranslate"><span class="pre">--version</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="parameters.html">Parameters</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="input_output.html">Input/output</a><ul>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#initial-conditions"><code class="docutils literal notranslate"><span class="pre">initial_conditions</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#output-dirs"><code class="docutils literal notranslate"><span class="pre">output_dirs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#output-bases"><code class="docutils literal notranslate"><span class="pre">output_bases</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#output-times"><code class="docutils literal notranslate"><span class="pre">output_times</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#autosave-interval"><code class="docutils literal notranslate"><span class="pre">autosave_interval</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#snapshot-select"><code class="docutils literal notranslate"><span class="pre">snapshot_select</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#powerspec-select"><code class="docutils literal notranslate"><span class="pre">powerspec_select</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#bispec-select"><code class="docutils literal notranslate"><span class="pre">bispec_select</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#render2d-select"><code class="docutils literal notranslate"><span class="pre">render2D_select</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#render3d-select"><code class="docutils literal notranslate"><span class="pre">render3D_select</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#snapshot-type"><code class="docutils literal notranslate"><span class="pre">snapshot_type</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#gadget-snapshot-params"><code class="docutils literal notranslate"><span class="pre">gadget_snapshot_params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#snapshot-wrap"><code class="docutils literal notranslate"><span class="pre">snapshot_wrap</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#select-particle-id"><code class="docutils literal notranslate"><span class="pre">select_particle_id</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#class-plot-perturbations"><code class="docutils literal notranslate"><span class="pre">class_plot_perturbations</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#class-extra-background"><code class="docutils literal notranslate"><span class="pre">class_extra_background</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="input_output.html#class-extra-perturbations"><code class="docutils literal notranslate"><span class="pre">class_extra_perturbations</span></code></a></li>
</ul>
</li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Numerics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#boxsize"><code class="docutils literal notranslate"><span class="pre">boxsize</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#potential-options"><code class="docutils literal notranslate"><span class="pre">potential_options</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#shortrange-params"><code class="docutils literal notranslate"><span class="pre">shortrange_params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#powerspec-options"><code class="docutils literal notranslate"><span class="pre">powerspec_options</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#bispec-options"><code class="docutils literal notranslate"><span class="pre">bispec_options</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#bispec-antialiasing"><code class="docutils literal notranslate"><span class="pre">bispec_antialiasing</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-dedicated-spectra"><code class="docutils literal notranslate"><span class="pre">class_dedicated_spectra</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#class-modes-per-decade"><code class="docutils literal notranslate"><span class="pre">class_modes_per_decade</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cosmology.html">Cosmology</a><ul>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#h0"><code class="docutils literal notranslate"><span class="pre">H0</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#b"><code class="docutils literal notranslate"><span class="pre">Ωb</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#cdm"><code class="docutils literal notranslate"><span class="pre">Ωcdm</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#a-begin"><code class="docutils literal notranslate"><span class="pre">a_begin</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#t-begin"><code class="docutils literal notranslate"><span class="pre">t_begin</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#primordial-spectrum"><code class="docutils literal notranslate"><span class="pre">primordial_spectrum</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#class-params"><code class="docutils literal notranslate"><span class="pre">class_params</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="cosmology.html#enable-class-background"><code class="docutils literal notranslate"><span class="pre">enable_class_background</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="physics.html">Physics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="physics.html#select-forces"><code class="docutils literal notranslate"><span class="pre">select_forces</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="physics.html#select-species"><code class="docutils literal notranslate"><span class="pre">select_species</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="physics.html#realization-options"><code class="docutils literal notranslate"><span class="pre">realization_options</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="physics.html#select-lives"><code class="docutils literal notranslate"><span class="pre">select_lives</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="physics.html#softening-kernel"><code class="docutils literal notranslate"><span class="pre">softening_kernel</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="physics.html#select-softening-length"><code class="docutils literal notranslate"><span class="pre">select_softening_length</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="simulation.html">Simulation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#t-base-background-factor"><code class="docutils literal notranslate"><span class="pre">Δt_base_background_factor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#t-base-nonlinear-factor"><code class="docutils literal notranslate"><span class="pre">Δt_base_nonlinear_factor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#t-increase-max-factor"><code class="docutils literal notranslate"><span class="pre">Δt_increase_max_factor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#t-rung-factor"><code class="docutils literal notranslate"><span class="pre">Δt_rung_factor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#a-max-early"><code class="docutils literal notranslate"><span class="pre">Δa_max_early</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#a-max-late"><code class="docutils literal notranslate"><span class="pre">Δa_max_late</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#static-timestepping"><code class="docutils literal notranslate"><span class="pre">static_timestepping</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#n-rungs"><code class="docutils literal notranslate"><span class="pre">N_rungs</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#fftw-wisdom-rigor"><code class="docutils literal notranslate"><span class="pre">fftw_wisdom_rigor</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#fftw-wisdom-reuse"><code class="docutils literal notranslate"><span class="pre">fftw_wisdom_reuse</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#fftw-wisdom-share"><code class="docutils literal notranslate"><span class="pre">fftw_wisdom_share</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#random-seeds"><code class="docutils literal notranslate"><span class="pre">random_seeds</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#primordial-noise-imprinting"><code class="docutils literal notranslate"><span class="pre">primordial_noise_imprinting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#primordial-amplitude-fixed"><code class="docutils literal notranslate"><span class="pre">primordial_amplitude_fixed</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#primordial-phase-shift"><code class="docutils literal notranslate"><span class="pre">primordial_phase_shift</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#cell-centered"><code class="docutils literal notranslate"><span class="pre">cell_centered</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#class-k-max"><code class="docutils literal notranslate"><span class="pre">class_k_max</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="simulation.html#class-reuse"><code class="docutils literal notranslate"><span class="pre">class_reuse</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="graphics.html">Graphics</a><ul>
<li class="toctree-l3"><a class="reference internal" href="graphics.html#terminal-width"><code class="docutils literal notranslate"><span class="pre">terminal_width</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="graphics.html#enable-terminal-formatting"><code class="docutils literal notranslate"><span class="pre">enable_terminal_formatting</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="graphics.html#render2d-options"><code class="docutils literal notranslate"><span class="pre">render2D_options</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="graphics.html#render3d-options"><code class="docutils literal notranslate"><span class="pre">render3D_options</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="units.html">Units</a><ul>
<li class="toctree-l3"><a class="reference internal" href="units.html#unit-length"><code class="docutils literal notranslate"><span class="pre">unit_length</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="units.html#unit-time"><code class="docutils literal notranslate"><span class="pre">unit_time</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="units.html#unit-mass"><code class="docutils literal notranslate"><span class="pre">unit_mass</span></code></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="debugging.html">Debugging</a><ul>
<li class="toctree-l3"><a class="reference internal" href="debugging.html#print-load-imbalance"><code class="docutils literal notranslate"><span class="pre">print_load_imbalance</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging.html#particle-reordering"><code class="docutils literal notranslate"><span class="pre">particle_reordering</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="debugging.html#enable-hubble"><code class="docutils literal notranslate"><span class="pre">enable_Hubble</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../utilities/utilities.html">Utilities</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../utilities/class.html">class utility</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#basic-usage">Basic usage</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#command-line-options">Command-line options</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#help-h-help">Help: <code class="docutils literal notranslate"><span class="pre">-h</span></code>, <code class="docutils literal notranslate"><span class="pre">--help</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#minimum-fourier-mode-kmin">Minimum Fourier mode: <code class="docutils literal notranslate"><span class="pre">--kmin</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#maximum-fourier-mode-kmax">Maximum Fourier mode: <code class="docutils literal notranslate"><span class="pre">--kmax</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#fourier-modes-modes">Fourier modes: <code class="docutils literal notranslate"><span class="pre">--modes</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#times-times">Times: <code class="docutils literal notranslate"><span class="pre">--times</span></code></a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#gauge-gauge">Gauge: <code class="docutils literal notranslate"><span class="pre">--gauge</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#file-contents">File contents</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#data-layout">Data layout</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#extra-output">Extra output</a></li>
<li class="toctree-l4"><a class="reference internal" href="../utilities/class.html#units">Units</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#complete-example-massive-neutrinos">Complete example (massive neutrinos)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#running-through-docker">Running through Docker</a></li>
<li class="toctree-l3"><a class="reference internal" href="../utilities/class.html#tips-and-tricks">Tips and tricks</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/convert.html">convert utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/gadget.html">gadget utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/info.html">info utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/play.html">play utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/powerspec.html">powerspec utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/bispec.html">bispec utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/render3D.html">render3D utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/update.html">update utility</a></li>
<li class="toctree-l2"><a class="reference internal" href="../utilities/watch.html">watch utility</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">Troubleshooting</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#installation-failed">Installation failed</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#compilation-failed">Compilation failed</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#insufficient-memory">Insufficient memory</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#dangerous-optimizations">Dangerous optimizations</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#terminal-colour-output-looks-weird">Terminal colour output looks weird</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#problems-related-to-python-libraries-and-packages">Problems related to Python libraries and packages</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#error-messages-containing-read-1">Error messages containing ‘Read -1’</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#clock-skew-and-or-modification-times-in-the-future">Clock skew and/or modification times in the future</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#mixed-compiled-and-pure-python-mode">Mixed compiled and pure Python mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#the-simulation-hangs-when-calling-class">The simulation hangs when calling CLASS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#crashes-or-other-bad-behaviour">Crashes or other bad behaviour</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#problems-when-running-remotely">Problems when running remotely</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#choosing-an-mpi-executor">Choosing an MPI executor</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#different-hardware-architecture-on-front-end-and-remote-node">Different hardware architecture on front-end and remote node</a></li>
<li class="toctree-l3"><a class="reference internal" href="../troubleshooting.html#it-still-does-not-work">It <em>still</em> does not work!</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#bad-performance-when-using-multiple-processes-nodes">Bad performance when using multiple processes/nodes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting.html#problems-when-using-multiple-nodes">Problems when using multiple nodes</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../publications.html">Publications</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../publications.html#theses">Theses</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">CO<em>N</em>CEPT</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="parameters.html">Parameters</a></li>
      <li class="breadcrumb-item active">Numerics</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/jmd-dk/concept/" class="fa fa-github"> Code Repository</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="input_output.html" class="btn btn-neutral float-left" title="Input/output" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cosmology.html" class="btn btn-neutral float-right" title="Cosmology" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="numerics">
<h1>Numerics<a class="headerlink" href="#numerics" title="Permalink to this heading"></a></h1>
<p>The ‘numerics’ parameter category contains parameters specifying various
options regarding the numerical methods used within the simulation, as well as
some numerical resolutions and length scales.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#boxsize" id="id9"><code class="docutils literal notranslate"><span class="pre">boxsize</span></code></a></p></li>
<li><p><a class="reference internal" href="#potential-options" id="id10"><code class="docutils literal notranslate"><span class="pre">potential_options</span></code></a></p></li>
<li><p><a class="reference internal" href="#shortrange-params" id="id11"><code class="docutils literal notranslate"><span class="pre">shortrange_params</span></code></a></p></li>
<li><p><a class="reference internal" href="#powerspec-options" id="id12"><code class="docutils literal notranslate"><span class="pre">powerspec_options</span></code></a></p></li>
<li><p><a class="reference internal" href="#bispec-options" id="id13"><code class="docutils literal notranslate"><span class="pre">bispec_options</span></code></a></p></li>
<li><p><a class="reference internal" href="#bispec-antialiasing" id="id14"><code class="docutils literal notranslate"><span class="pre">bispec_antialiasing</span></code></a></p></li>
<li><p><a class="reference internal" href="#class-dedicated-spectra" id="id15"><code class="docutils literal notranslate"><span class="pre">class_dedicated_spectra</span></code></a></p></li>
<li><p><a class="reference internal" href="#class-modes-per-decade" id="id16"><code class="docutils literal notranslate"><span class="pre">class_modes_per_decade</span></code></a></p></li>
</ul>
</nav>
<hr class="docutils" />
<section id="boxsize">
<span id="id1"></span><h2><a class="toc-backref" href="#id9" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">boxsize</span></code></a><a class="headerlink" href="#boxsize" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifies size of simulation box</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="mi">512</span><span class="o">*</span><span class="n">Mpc</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>All CO<em>N</em>CEPT simulations take place within a cubic
box of constant comoving side length
<span class="math notranslate nohighlight">\(L_{\text{box}}\)</span>. This parameter sets this length.</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Use a box size of <span class="math notranslate nohighlight">\(1024\,\text{Mpc}\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxsize</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="n">Mpc</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Use a box size of
<span class="math notranslate nohighlight">\(1\,\text{Gpc} = 1000\,\text{Mpc}\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxsize</span> <span class="o">=</span> <span class="mi">1</span><span class="o">*</span><span class="n">Gpc</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 2</strong></p></td>
<td><p></p></td>
<td><p>Use a box size of <span class="math notranslate nohighlight">\(1024\,\text{Mpc}/h\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxsize</span> <span class="o">=</span> <span class="mi">1024</span><span class="o">*</span><span class="n">Mpc</span><span class="o">/</span><span class="n">h</span>
</pre></div>
</div>
<p>With e.g.
<span class="math notranslate nohighlight">\(H_0 = 64\,\text{km}\, \text{s}^{-1}\, \text{Mpc}^{-1}\)</span>,
this is equivalent to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">boxsize</span> <span class="o">=</span> <span class="mi">1600</span><span class="o">*</span><span class="n">Mpc</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>See the <code class="docutils literal notranslate"><span class="pre">H0</span></code> <a class="reference internal" href="cosmology.html#h0"><span class="std std-ref">parameter</span></a> for details on
<code class="docutils literal notranslate"><span class="pre">h</span></code></p>
</div>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="potential-options">
<span id="id2"></span><h2><a class="toc-backref" href="#id10" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">potential_options</span></code></a><a class="headerlink" href="#potential-options" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifications for potential computations</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{},</span>
        <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span>  <span class="s1">&#39;cbrt(Ñ)&#39;</span><span class="p">,</span>   <span class="s1">&#39;cbrt(Ñ)&#39;</span><span class="p">),</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;2*cbrt(Ñ)&#39;</span><span class="p">,</span> <span class="s1">&#39;2*cbrt(Ñ)&#39;</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;cbrt(Ñ)&#39;</span><span class="p">,</span> <span class="s1">&#39;cbrt(Ñ)&#39;</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s1">&#39;fluid&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;gridsize&#39;</span><span class="p">,</span> <span class="s1">&#39;gridsize&#39;</span><span class="p">),</span>
            <span class="p">},</span>
            <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;gridsize&#39;</span><span class="p">,</span> <span class="s1">&#39;gridsize&#39;</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="s1">&#39;CIC&#39;</span><span class="p">,</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="s1">&#39;CIC&#39;</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;deconvolve&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;interlace&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">},</span>
        <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;differentiation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="s1">&#39;lapse&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>This parameter is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of several individual
sub-parameters, specifying the details of how
potentials are constructed and applied to components.
Below you will find a summary of how potentials are
implemented in CO<em>N</em>CEPT, after which the
sub-parameters are described.</p>
<p>Potentials are discretised on grids in order to
implement long-range interactions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Currently, two distinct long-range
interactions/forces are implemented; <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code>
(via the PM or P³M method, the latter of which
further has a short-range part) and <code class="docutils literal notranslate"><span class="pre">'lapse'</span></code>
(via the PM method). The <code class="docutils literal notranslate"><span class="pre">'lapse'</span></code> interaction is
relatively obscure and has to do with gravitational
time dilation. See the
<a class="reference internal" href="../tutorial/beyond_matter_only.html#decaying-cold-dark-matter"><span class="std std-ref">decaying cold dark matter part of the tutorial</span></a>
as well as the paper on
‘<a class="reference internal" href="../publications.html#fully-relativistic-treatment-of-decaying-cold-dark-matter-in-nbody-simulations"><span class="std std-ref">Fully relativistic treatment of decaying cold dark matter in 𝘕-body simulations</span></a>’
for details on the <code class="docutils literal notranslate"><span class="pre">'lapse'</span></code> interaction/potential.
For specifications of forces and methods, see the
<code class="docutils literal notranslate"><span class="pre">select_forces</span></code> <a class="reference internal" href="physics.html#select-forces"><span class="std std-ref">parameter</span></a>.
Though we shall focus on <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> below, all
long-range interactions and their potentials
behave similarly.</p>
</div>
<p>In CO<em>N</em>CEPT a long-range interaction takes place
between two groups of
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">components</span></a>;
the <em>suppliers</em> and the <em>receivers</em>, which respectively
build the potential and receive a force due to it. In
the simplest case of self-gravity between particles of
a single component, this component is both the sole
supplier and receiver component.</p>
<p>CO<em>N</em>CEPT uses an ‘<em>upstream</em> <span class="math notranslate nohighlight">\(\rightarrow\)</span>
<em>global</em> <span class="math notranslate nohighlight">\(\rightarrow\)</span> <em>downstream</em> scheme’ for
potentials, as outlined below:</p>
<ol class="arabic">
<li><p>Interpolate each supplier component onto individual
‘upstream’ grids, the size of which are individual to
each component. More precisely, a specific quantity
of the supplier components is interpolated, e.g. the
mass (particle components) or energy density (fluid
components) in the case of gravity. For particle
components, the interpolation may be interlaced,
meaning carried out multiple times with shifted
grids.</p></li>
<li><p>Transform each upstream grid to Fourier space.</p></li>
<li><p>Optionally perform deconvolution and/or shifting of
the complex phase (due to interlacing) of upstream
grids constructed from particle suppliers (see
“<a class="reference external" href="https://dx.doi.org/10.1201/9780367806934">Computer simulation using particles</a>”).</p></li>
<li><p>Add upstream Fourier grids together, producing a
‘global’ Fourier grid, with the global grid size
being a free parameter.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Grids of different sizes can be seamlessly added
together in Fourier space, as all
<span class="math notranslate nohighlight">\(\boldsymbol{k}\)</span> modes (grid cells) of
smaller grids are contained within larger grids.
Complex phase shifts are needed to correct for the
change of grid size, all taken care of
by CO<em>N</em>CEPT.</p>
</div>
</li>
<li><p>Convert the values within the global grid to
potential values. For gravity, this amounts to
solving the Poisson equation.</p></li>
<li><p>For each receiver component, produce a ‘downstream’
version of the global Fourier potential by copying
(and shifting) the modes onto grids individual to
each receiver.</p></li>
<li><p>Optionally perform (another) deconvolution for
downstream grids of particle receivers, due to the
upcoming interpolation back to the particle
positions.</p></li>
</ol>
<p>For receivers obtaining the force grid from the
downstream real-space potential grid:</p>
<blockquote>
<div><ol class="arabic simple" start="8">
<li><p>Transform downstream potential to real space.</p></li>
<li><p>Obtain force grid by differentiating the
downstream real-space potential using some finite
difference method.</p></li>
</ol>
</div></blockquote>
<p>For receivers obtaining the force grid from the
downstream Fourier-space potential:</p>
<blockquote>
<div><ol class="arabic simple" start="8">
<li><p>Obtain Fourier-space force grid by differentiating
the downstream Fourier-space potential through
multiplication by
<span class="math notranslate nohighlight">\(\mathrm{i}\boldsymbol{k}\)</span>.</p></li>
<li><p>Transform the force grid to real space.</p></li>
</ol>
</div></blockquote>
<ol class="arabic simple" start="10">
<li><p>Apply each force grid by interpolating it back onto
the corresponding receiver. This downstream
interpolation may again be carried out using
interlacing, requiring steps 8–9 to be carried out
multiple times as well as shifting of the
complex phases.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Though the above recipe is conceptually faithful to
the actual implementation in CO<em>N</em>CEPT, typically
many of the steps can be combined, reducing the
total number of steps (and grids in memory)
significantly. In all cases, CO<em>N</em>CEPT collapses
the above procedure to its minimal equivalence,
which in simple (typical) cases among other things
leaves out the upstream and downstream potentials
completely and combines the two deconvolutions into
one.</p>
</div>
<p>With the implemented potential scheme outlined above,
the different sub-parameters of the
<code class="docutils literal notranslate"><span class="pre">potential_options</span></code> parameter are presented below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code>: This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> which functions as
a
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selection</span></a>,
mapping components to <code class="docutils literal notranslate"><span class="pre">dict</span></code>s specifying the
various grid sizes, e.g.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="n">gridsize_pm_upstream</span><span class="p">,</span>  <span class="n">gridsize_pm_downstream</span><span class="p">),</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">gridsize_p3m_upstream</span><span class="p">,</span> <span class="n">gridsize_p3m_downstream</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where <code class="docutils literal notranslate"><span class="pre">'matter'</span></code> is used as a stand-in for some
component and <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> could be any long-range
interaction. The <code class="docutils literal notranslate"><span class="pre">gridsize_*</span></code> variables are then
integers specifying the upstream and downstream grid
sizes (i.e. the number of grid cells along each
dimension) for the given interaction and component.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>One can refer to the number of particles <span class="math notranslate nohighlight">\(N\)</span>
by using <code class="docutils literal notranslate"><span class="pre">'N'</span></code> within a <code class="docutils literal notranslate"><span class="pre">str</span></code>, as used in the
above default specifications. Similarly,
<code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code> can be used to refer to the
intrinsic ‘fluid grid size’ of fluid components.
Importantly, fluid components must have upstream
and downstream grid sizes equal to their fluid grid
size. For particle components with <span class="math notranslate nohighlight">\(N = 2n^3\)</span>
or <span class="math notranslate nohighlight">\(N = 4n^3\)</span> particles (pre-initialised on
interleaved lattices, see the <code class="docutils literal notranslate"><span class="pre">initial_conditions</span></code>
<a class="reference internal" href="input_output.html#initial-conditions"><span class="std std-ref">parameter</span></a>), you can
refer to just the cubic part as <code class="docutils literal notranslate"><span class="pre">'Ñ'</span></code>. That is,
regardless of whether the number of particles is
<span class="math notranslate nohighlight">\(N = n^3\)</span>, <span class="math notranslate nohighlight">\(N = 2n^3\)</span> or
<span class="math notranslate nohighlight">\(N = 4n^3\)</span>, we always have
<span class="math notranslate nohighlight">\(\widetilde{N} = n^3\)</span>.</p>
</div>
<p>A special key <code class="docutils literal notranslate"><span class="pre">'global'</span></code> is further specified within
the <code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code> sub-<code class="docutils literal notranslate"><span class="pre">dict</span></code>, with a value of the
form</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="n">gridsize_pm_global</span><span class="p">,</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="n">gridsize_p3m_global</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where again <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> could be any long-range
interaction, with the <code class="docutils literal notranslate"><span class="pre">gridsize_*_global</span></code> parameters
specifying the global grid sizes to use for this
interaction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <code class="docutils literal notranslate"><span class="pre">'global'</span></code> <code class="docutils literal notranslate"><span class="pre">dict</span></code> within the <code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code>
sub-parameter does not have a default value, as
appropriate grid sizes depend on the components
used within the simulation.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'interpolation'</span></code>: This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of the form</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="n">order_interp_pm</span><span class="p">,</span>
        <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="n">order_interp_p3m</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>where the <code class="docutils literal notranslate"><span class="pre">order_interp_*</span></code> variables specify the
interpolation order to use when interpolating
particles to/from upstream/downstream grids. The
implemented interpolations are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'NPG'</span></code>: ‘Nearest grid point’, order <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'CIC'</span></code>: ‘Cloud in cell’, order <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'TSC'</span></code>: ‘Triangular shaped cloud’, order <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'PCS'</span></code>: ‘Piecewise cubic spline’, order <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p></li>
</ul>
<p>These may be specified using either their name (e.g.
<code class="docutils literal notranslate"><span class="pre">'CIC'</span></code>) or integer order (e.g. <code class="docutils literal notranslate"><span class="pre">2</span></code>). See the
paper on
‘<a class="reference internal" href="../publications.html#the-cosmological-simulation-code-concept-10"><span class="std std-ref">The cosmological simulation code CO𝘕CEPT 1.0</span></a>’
for details on these.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'deconvolve'</span></code>: This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of the form</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;deconvolve&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="n">deconv_pm_upstream</span><span class="p">,</span>  <span class="n">deconv_pm_downstream</span><span class="p">),</span>
        <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">deconv_p3m_upstream</span><span class="p">,</span> <span class="n">deconv_p3m_downstream</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>with the <code class="docutils literal notranslate"><span class="pre">deconv_*</span></code> variables specifying whether
deconvolution due to particle upstream and downstream
interpolation should take place.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'interlace'</span></code>: This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of the form</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;dinterlace&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="p">(</span><span class="n">interlace_pm_upstream</span><span class="p">,</span>  <span class="n">interlace_pm_downstream</span><span class="p">),</span>
        <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">interlace_p3m_upstream</span><span class="p">,</span> <span class="n">interlace_p3m_downstream</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>with the <code class="docutils literal notranslate"><span class="pre">interlace_*</span></code> variables specifying whether
grid interlacing should be used for particle upstream
and downstream interpolation.  Possible values are
<code class="docutils literal notranslate"><span class="pre">'sc'</span></code> (or <code class="docutils literal notranslate"><span class="pre">False</span></code>) for a simple cubic lattice
(meaning no interlacing), <code class="docutils literal notranslate"><span class="pre">'bcc'</span></code> (or <code class="docutils literal notranslate"><span class="pre">True</span></code>) for
a body-centered cubic lattice (meaning standard
interlacing involving two relatively shifted particle
interpolations) or <code class="docutils literal notranslate"><span class="pre">'fcc'</span></code> for a face-centered cubic
lattice (meaning interlacing involving four relatively
shifted particle interpolations).</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'differentiation'</span></code>: This is a
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selection</span></a>
<code class="docutils literal notranslate"><span class="pre">dict</span></code> of the form</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;differentiation&#39;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="n">order_diff_pm</span><span class="p">,</span>
            <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="n">order_diff_p3m</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>with the <code class="docutils literal notranslate"><span class="pre">order_diff_*</span></code> variables specifying the
order of differentiation to use to construct the force
grid(s) from the (downstream) potential grid(s). For
real-space differentiation, symmetric finite
differencing of orders <code class="docutils literal notranslate"><span class="pre">2</span></code>, <code class="docutils literal notranslate"><span class="pre">4</span></code>, <code class="docutils literal notranslate"><span class="pre">6</span></code> and <code class="docutils literal notranslate"><span class="pre">8</span></code>
are implemented (see the paper on
‘<a class="reference internal" href="../publications.html#the-cosmological-simulation-code-concept-10"><span class="std std-ref">The cosmological simulation code CO𝘕CEPT 1.0</span></a>’
for details). If instead you wish to make use of
Fourier-space differentiation, set the order to either
<code class="docutils literal notranslate"><span class="pre">'Fourier'</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Use default potential options, but set the global
gravitational P³M potential grid size to <span class="math notranslate nohighlight">\(128\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This can be shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>though now both the P³M and PM method of gravity gets a
global grid size of <span class="math notranslate nohighlight">\(128\)</span> (if the simulation does
not make use of PM, this does not matter). The above can
be further shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here it will be detected that no force/interaction has
been specified, in which case the default one
— <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> — will be used. The above can be
further shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>though this now also sets <code class="docutils literal notranslate"><span class="pre">128</span></code> as the upstream and
downstream grid sizes for <code class="docutils literal notranslate"><span class="pre">'all'</span></code> components. In
simple cases with e.g. only one component, this is
typically what we want. Finally, this can be simplified
to just</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="mi">128</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Use default potential options, but set the
gravitational P³M potential grid size to <span class="math notranslate nohighlight">\(128\)</span>,
for the global potential as well as for the upstream
and downstream potential grids for the component with a
name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>. For PM gravity, use a
global potential grid of size <span class="math notranslate nohighlight">\(64\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span> <span class="p">:</span>  <span class="mi">64</span><span class="p">,</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">128</span><span class="p">),</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As the upstream and downstream grid size within the
2-tuple are identical, this can be shortened to</p>
</div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;global&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span> <span class="p">:</span>  <span class="mi">64</span><span class="p">,</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This further assigns <code class="docutils literal notranslate"><span class="pre">64</span></code> as the upstream and
downstream gravity PM grid sizes for all components
for which these are unset, including <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 2</strong></p></td>
<td><p></p></td>
<td><p>For the gravitational interaction, be it PM or P³M, make
use of the highest available order for particle
interpolation (PCS), as well as both upstream and
downstream (standard) interlacing. Use <span class="math notranslate nohighlight">\(80\)</span> as the
size of all potential grids.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="mi">80</span><span class="p">,</span>
    <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="s1">&#39;PCS&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;interlace&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>  <span class="c1"># or (&#39;bcc&#39;, &#39;bcc&#39;)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 3</strong></p></td>
<td><p></p></td>
<td><p>Use <span class="math notranslate nohighlight">\(128\)</span> as the size of all potential grids, use
order-6 real-space finite differencing to obtain the
force from the gravitational PM potential and use
Fourier-space differentiation to obtain the force from
the gravitational P³M potential:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">potential_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="mi">128</span><span class="p">,</span>
    <span class="s1">&#39;differentiation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;all&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pm&#39;</span> <span class="p">:</span> <span class="mi">6</span><span class="p">,</span>
                <span class="s1">&#39;p3m&#39;</span><span class="p">:</span> <span class="s1">&#39;Fourier&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="shortrange-params">
<span id="id3"></span><h2><a class="toc-backref" href="#id11" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">shortrange_params</span></code></a><a class="headerlink" href="#shortrange-params" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifications for short-range forces</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;scale&#39;</span>    <span class="p">:</span> <span class="s1">&#39;1.25*boxsize/gridsize&#39;</span><span class="p">,</span>
        <span class="s1">&#39;range&#39;</span>    <span class="p">:</span> <span class="s1">&#39;4.5*scale&#39;</span><span class="p">,</span>
        <span class="s1">&#39;tilesize&#39;</span> <span class="p">:</span> <span class="s1">&#39;range&#39;</span><span class="p">,</span>
        <span class="s1">&#39;subtiling&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;automatic&#39;</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
        <span class="s1">&#39;tablesize&#39;</span><span class="p">:</span> <span class="mi">4096</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>This parameter is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> which maps
short-range interactions to sub-parameter <code class="docutils literal notranslate"><span class="pre">dict</span></code>s,
which specifies sub-parameters for each short-range
force. Currently, <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> is the only short-range
force implemented. For detailed information about the
short-range force — including the short-/long-range
force split scale <span class="math notranslate nohighlight">\(x_{\text{s}}\)</span> and cut-off
<span class="math notranslate nohighlight">\(x_{\text{r}}\)</span> as well as tiles, subtiles and
automatic refinement thereof — we refer to the paper
on
‘<a class="reference internal" href="../publications.html#the-cosmological-simulation-code-concept-10"><span class="std std-ref">The cosmological simulation code CO𝘕CEPT 1.0</span></a>’.</p>
<p>Each of the sub-parameters are described below.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'scale'</span></code>: This is the short-/long-range force split
scale <span class="math notranslate nohighlight">\(x_{\text{s}}\)</span>, specifying the scale at
which the short- and long-range P³M forces are
comparable. The default value corresponds to a scale
of <span class="math notranslate nohighlight">\(1.25\)</span> grid cell widths, as <code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code> is
dynamically substituted for the global grid size of
the long-range potential grid. See the
<code class="docutils literal notranslate"><span class="pre">potential_options</span></code>
<a class="reference internal" href="#potential-options"><span class="std std-ref">parameter</span></a>
for details on this grid.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'range'</span></code>: This is the cut-off scale
<span class="math notranslate nohighlight">\(x_{\text{r}}\)</span>, specifying the range of the
short-range force. The default value is set to
<span class="math notranslate nohighlight">\(4.5 x_{\text{s}}\)</span>, as <code class="docutils literal notranslate"><span class="pre">'scale'</span></code> is being
dynamically substituted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'tilesize'</span></code>: This sets the (minimum) width of the
tiles. To ensure that all particle pairs within
<span class="math notranslate nohighlight">\(x_{\text{r}}\)</span> of each other gets paired up,
this should be set no lower than
<span class="math notranslate nohighlight">\(x_{\text{r}}\)</span>, i.e. <code class="docutils literal notranslate"><span class="pre">'range'</span></code>. At the same
time, there is typically no reason to set a larger
value, as this just slows down the short-range
interaction without actually increasing the number of
particle-particle interactions.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'subtiling'</span></code>: This specifies the subtile
decomposition. It may be defined as a triplet of
integers specifying a fixed decomposition or a single
integer specifying a fixed cubic decomposition.
Alternatively, it may be defined to be the <code class="docutils literal notranslate"><span class="pre">str</span></code>
<code class="docutils literal notranslate"><span class="pre">'automatic'</span></code>, which specifies automatic and dynamic
subtile refinement, or a 2-tuple with <code class="docutils literal notranslate"><span class="pre">'automatic'</span></code>
as the first element and the length of the refinement
period (in number of time steps) as the second
element.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The automatic subtile refinement is based on CPU
timing measurements within the simulation and so
breaks strict deterministic behaviour.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'tablesize'</span></code>: The gravitational short-range force
between two particles is a complicated expression, and
so it is pre-tabulated, with actual forces found
through cheap (1D) NGP lookups in this table. As we do
not even use linear interpolation, this table needs to
be rather large. Exactly how large is controlled by
the <code class="docutils literal notranslate"><span class="pre">'tablesize'</span></code> sub-parameter.</p></li>
</ul>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Extend <span class="math notranslate nohighlight">\(x_{\text{r}}\)</span> all the way to
<span class="math notranslate nohighlight">\(5.5 x_{\text{s}}\)</span>, for the gravitational
short-range interaction:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shortrange_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gravity&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="s1">&#39;1.25*boxsize/gridsize&#39;</span><span class="p">,</span>
        <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="s1">&#39;5.5*scale&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We can shorten the above to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shortrange_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="s1">&#39;1.25*boxsize/gridsize&#39;</span><span class="p">,</span>
    <span class="s1">&#39;range&#39;</span><span class="p">:</span> <span class="s1">&#39;5.5*scale&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in which case <code class="docutils literal notranslate"><span class="pre">'gravity'</span></code> will be set as the
force/interaction automatically, as it is the default
force/interaction.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In both cases, the remaining sub-parameters will
receive default values</p>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Use a fixed subtile decomposition of
<span class="math notranslate nohighlight">\((3, 3, 3)\)</span> for the gravitational short-range
interaction:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shortrange_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;subtiling&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As all three subdivisions are equal, this can be
shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shortrange_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;subtiling&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>While probably a bit slower than using automatic subtile
refinement, this subtile decomposition has the benefit of
being static and thus deterministic.</p>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 2</strong></p></td>
<td><p></p></td>
<td><p>Use dynamic subtile refinement with a period
of <span class="math notranslate nohighlight">\(8\)</span> time steps for the gravitational
short-range interaction:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">shortrange_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;subtiling&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;automatic&#39;</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="powerspec-options">
<span id="id4"></span><h2><a class="toc-backref" href="#id12" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">powerspec_options</span></code></a><a class="headerlink" href="#powerspec-options" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifications for power spectrum computations
and dumps</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;upstream gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="s1">&#39;2*cbrt(Ñ)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fluid&#39;</span>    <span class="p">:</span> <span class="s1">&#39;gridsize&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;global gridsize&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;PCS&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;deconvolve&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;interlace&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;realization correction&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;k_max&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;nyquist&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;bins per decade&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;  4*k_min&#39;</span><span class="p">:</span>  <span class="mi">4</span><span class="p">,</span>
            <span class="s1">&#39;100*k_min&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;tophat&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="o">*</span><span class="n">Mpc</span><span class="o">/</span><span class="n">h</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;significant figures&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of several individual sub-parameters,
specifying details of how to compute and save power
spectra. All sub-parameters are themselves
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selections</span></a>.</p>
<p>For computing a power spectrum, one or more components
are first interpolated onto individual <em>upstream</em> grids,
possibly using deconvolution and interlacing, after
which they are added together in Fourier space,
producing a <em>global</em> grid. This scheme is similar to the
one used for potentials, except here we never go back to
real space, neither do we interpolate anything back to
the particles. See the <code class="docutils literal notranslate"><span class="pre">potential_options</span></code>
<a class="reference internal" href="#potential-options"><span class="std std-ref">parameter</span></a> for a walk-through
of the scheme.</p>
<p>Each sub-parameter is described below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'upstream</span> <span class="pre">gridsize'</span></code>: Specifies the upstream grid
sizes to use for each component. See the
<code class="docutils literal notranslate"><span class="pre">potential_options</span></code>
<a class="reference internal" href="#potential-options"><span class="std std-ref">parameter</span></a> for the use of
the <code class="docutils literal notranslate"><span class="pre">'Ñ'</span></code> notation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'global</span> <span class="pre">gridsize'</span></code>: Specifies the global grid size
to use for each power spectrum. Which power spectra to
compute are in turn specified by the
<code class="docutils literal notranslate"><span class="pre">powerspec_select</span></code>
<a class="reference internal" href="input_output.html#powerspec-select"><span class="std std-ref">parameter</span></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This has no default value, as a proper global grid
size depends on the components within the
simulation. If this is not set when a power
spectrum is to be computed, a value equal to the
largest of the upstream grid sizes (in use for this
particular power spectrum) will be used.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'interpolation'</span></code>: Specifies the interpolation order
to use when interpolating particles to upstream grids.
The implemented interpolations are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'NPG'</span></code>: ‘Nearest grid point’, order <code class="docutils literal notranslate"><span class="pre">1</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'CIC'</span></code>: ‘Cloud in cell’, order <code class="docutils literal notranslate"><span class="pre">2</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'TSC'</span></code>: ‘Triangular shaped cloud’, order <code class="docutils literal notranslate"><span class="pre">3</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'PCS'</span></code>: ‘Piecewise cubic spline’, order <code class="docutils literal notranslate"><span class="pre">4</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'deconvolve'</span></code>: Specifies whether to apply
deconvolution for upstream particle interpolations.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'interlace'</span></code>: Specifies whether to use interlacing
for upstream particle interpolations. Possible values
are <code class="docutils literal notranslate"><span class="pre">'sc'</span></code> (or <code class="docutils literal notranslate"><span class="pre">False</span></code>) for a simple cubic lattice
(meaning no interlacing), <code class="docutils literal notranslate"><span class="pre">'bcc'</span></code> (or <code class="docutils literal notranslate"><span class="pre">True</span></code>) for
a body-centered cubic lattice (meaning standard
interlacing involving two relatively shifted particle
interpolations) or <code class="docutils literal notranslate"><span class="pre">'fcc'</span></code> for a face-centered cubic
lattice (meaning interlacing involving four relatively
shifted particle interpolations).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'realization</span> <span class="pre">correction'</span></code>: Specifies whether to
also correct for the current realisation
(cosmic variance) when computing <em>corrected</em> power
spectra (see the <code class="docutils literal notranslate"><span class="pre">powerspec_select</span></code>
<a class="reference internal" href="input_output.html#powerspec-select"><span class="std std-ref">parameter</span></a>), as opposed to
only correcting for noise stemming from the binning
procedure.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'k_max'</span></code>: Specifies the largest <span class="math notranslate nohighlight">\(k\)</span> mode to
include in the power spectrum output files (data files
and plots). If given as a <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">'nyquist'</span></code> is
dynamically substituted for the Nyquist mode,</p>
<div class="math notranslate nohighlight">
\[\require{upgreek}
k_{\text{Nyquist}} = \biggl\lfloor\frac{n_{\text{ps}}}{2}\biggr\rfloor \times \frac{2\uppi}{L_{\text{box}}}\, ,\]</div>
<p>with <span class="math notranslate nohighlight">\(L_{\text{box}}\)</span> given by <code class="docutils literal notranslate"><span class="pre">boxsize</span></code> and
<span class="math notranslate nohighlight">\(n_{\text{ps}}\)</span> the global grid size used for
the power spectrum.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Setting <code class="docutils literal notranslate"><span class="pre">'k_max'</span></code> above <code class="docutils literal notranslate"><span class="pre">'sqrt(3)*nyquist'</span></code>
will not yield further data points, as no further
data is available in the 3D grid.</p>
</div>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'bins</span> <span class="pre">per</span> <span class="pre">decade'</span></code>: Specifies the number of power
spectrum bins per decade in <span class="math notranslate nohighlight">\(k\)</span>. By specifying
different numbers at different <span class="math notranslate nohighlight">\(k\)</span>, a running
(logarithmically interpolated) number of bins is
obtained. When the <span class="math notranslate nohighlight">\(k\)</span>‘s are given as
<code class="docutils literal notranslate"><span class="pre">str</span></code>s, the following sub<code class="docutils literal notranslate"><span class="pre">str</span></code>s are
dynamically substituted:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'k_min'</span></code>: <code class="docutils literal notranslate"><span class="pre">2*π/boxsize</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'k_max'</span></code>: Value set for <code class="docutils literal notranslate"><span class="pre">'k_max'</span></code>, though at
most <code class="docutils literal notranslate"><span class="pre">sqrt(3)*(gridsize//2)*k_min</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code>: <code class="docutils literal notranslate"><span class="pre">gridsize</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nyquist'</span></code>: <code class="docutils literal notranslate"><span class="pre">gridsize//2*k_min</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'k_fundamental'</span></code>/<code class="docutils literal notranslate"><span class="pre">'k_f'</span></code>: <code class="docutils literal notranslate"><span class="pre">2*π/boxsize</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'tophat'</span></code>: Included in the power spectrum data
files is also the root-mean-square density variation
<span class="math notranslate nohighlight">\(\sigma_R\)</span>, smoothed with a spherical
top-hat filter <span class="math notranslate nohighlight">\(W(s)\)</span> of radius <span class="math notranslate nohighlight">\(R\)</span>:</p>
<div class="math notranslate nohighlight">
\[\begin{split}\require{upgreek}
\sigma_R &amp;= \frac{1}{2\uppi^2} \left( \int k^2 W^2(kR) P(k)\,\mathrm{d}k \right)^{\frac{1}{2}}\, , \\
W(s) &amp;= \frac{3}{s^3}\bigl(\sin(s) - s\cos(s)\bigr)\, ,\end{split}\]</div>
<p>with <span class="math notranslate nohighlight">\(P(k)\)</span> the power spectrum.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Though the integral should really be over all
<span class="math notranslate nohighlight">\(k\)</span>, naturally we can only use those within
the tabulated power spectrum</p>
</div>
<p>The radius <span class="math notranslate nohighlight">\(R\)</span> is controlled by this
sub-parameter. The default value of <code class="docutils literal notranslate"><span class="pre">8*Mpc/h</span></code>
results in the standard <span class="math notranslate nohighlight">\(\sigma_8\)</span>.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'significant</span> <span class="pre">figures'</span></code>: Specifies the number of
significant figures to use for the data in the power
spectrum data files.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For all sub-parameters above except
<code class="docutils literal notranslate"><span class="pre">'upstream</span> <span class="pre">gridsize'</span></code>, the keys used within the
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selection</span></a>
sub-<code class="docutils literal notranslate"><span class="pre">dict</span></code>s may refer to either a single
component or a combination of components. In the case
of the latter, this designates a combined (auto)
power spectrum.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Use an upstream grid size of <span class="math notranslate nohighlight">\(256\)</span> for the
component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">powerspec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;upstream gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>As we did not specify a global grid size, this will
similarly be <span class="math notranslate nohighlight">\(256\)</span>. We can also set both
explicitly by using</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">powerspec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="mi">256</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code> is not a real sub-parameter of
<code class="docutils literal notranslate"><span class="pre">powerspec_options</span></code>. It merely acts as a convenient
shortcut for setting both <code class="docutils literal notranslate"><span class="pre">'upstream</span> <span class="pre">gridsize'</span></code> and
<code class="docutils literal notranslate"><span class="pre">'global</span> <span class="pre">gridsize'</span></code>.</p>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Employ many (small) bins of the same (logarithmic) size
for all <span class="math notranslate nohighlight">\(k\)</span> of every power spectrum:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">powerspec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bins per decade&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;all&#39;</span>             <span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;all combinations&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This may be shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">powerspec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;bins per decade&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 2</strong></p></td>
<td><p></p></td>
<td><p>Use CIC interpolation and disable interlacing for power
spectra of the component with a name/species of
<code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">powerspec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;CIC&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;interlace&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># or &#39;sc&#39;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="bispec-options">
<span id="id5"></span><h2><a class="toc-backref" href="#id13" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">bispec_options</span></code></a><a class="headerlink" href="#bispec-options" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifications for bispectrum computations
and dumps</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">{</span>
                <span class="s1">&#39;1*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;0.25*k_fundamental&#39;</span><span class="p">,</span>
                <span class="s1">&#39;4*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;max(3*k_fundamental, 1/20*log(10)*k)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;1*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;0.25*k_fundamental&#39;</span><span class="p">,</span>
                <span class="s1">&#39;4*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;max(3*k_fundamental, 1/20*log(10)*k)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="p">{</span>
                <span class="s1">&#39;1*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;0.25*k_fundamental&#39;</span><span class="p">,</span>
                <span class="s1">&#39;4*k_fundamental&#39;</span><span class="p">:</span> <span class="s1">&#39;max(3*k_fundamental, 1/20*log(10)*k)&#39;</span><span class="p">,</span>
            <span class="p">},</span>
        <span class="p">]</span>
    <span class="p">},</span>
    <span class="s1">&#39;upstream gridsize&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;particles&#39;</span><span class="p">:</span> <span class="s1">&#39;2*cbrt(Ñ)&#39;</span><span class="p">,</span>
        <span class="s1">&#39;fluid&#39;</span>    <span class="p">:</span> <span class="s1">&#39;gridsize&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;global gridsize&#39;</span><span class="p">:</span> <span class="p">{},</span>
    <span class="s1">&#39;interpolation&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="s1">&#39;PCS&#39;</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;deconvolve&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;interlace&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="s1">&#39;significant figures&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>This is a <code class="docutils literal notranslate"><span class="pre">dict</span></code> of several individual sub-parameters,
specifying details of how to compute and save bispectra.
All sub-parameters are themselves
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selections</span></a>.</p>
<p>For computing a bispectrum, one or more components are
first interpolated onto individual <em>upstream</em> grids,
possibly using deconvolution and interlacing, after
which they are added together in Fourier space,
producing a <em>global</em> grid. This scheme is similar to the
one used for potentials, except here we never go back to
real space, neither do we interpolate anything back to
the particles. See the <code class="docutils literal notranslate"><span class="pre">potential_options</span></code>
<a class="reference internal" href="#potential-options"><span class="std std-ref">parameter</span></a> for a walk-through
of the scheme.</p>
<p>Many of the sub-parameters are the same as within the
<code class="docutils literal notranslate"><span class="pre">powerspec_options</span></code>
<a class="reference internal" href="#powerspec-options"><span class="std std-ref">parameter</span></a>, and have the same
meaning. These will not be reiterated here. The
remaining sub-parameters are described below:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">'configuration'</span></code>: Specifies the triangle
configurations for which to compute the bispectrum for
each component. Rather than writing the bispectrum as
a function of the length of the three wave vectors
<span class="math notranslate nohighlight">\(B(k_1, k_2, k_3)\)</span>, CO<em>N</em>CEPT makes use of
parametrisation <span class="math notranslate nohighlight">\(B(k, t, \mu)\)</span>, where</p>
<div class="math notranslate nohighlight">
\[\begin{split}k &amp;\equiv k_1\,,\\
t &amp;\equiv \frac{k_2}{k_1}\,,\\
\mu &amp;\equiv \frac{k_1^2 + k_2^2 - k_3^2}{2k_1k_2}\,,\end{split}\]</div>
<p>or conversely</p>
<div class="math notranslate nohighlight">
\[\begin{split}k_1 &amp;\equiv k\,,\\
k_2 &amp;\equiv tk_1\,,\\
k_3 &amp;\equiv \sqrt{k_1^2 + k_2^2 - 2\mu k_1k_2}\,.\end{split}\]</div>
<p>Using this parametrisation, the configurations to use
may be specified in multiple different ways:</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">(k,</span> <span class="pre">t,</span> <span class="pre">μ)</span></code>: Single configuration, corresponding
to one bispectrum bin. Note that <code class="docutils literal notranslate"><span class="pre">k</span></code>, <code class="docutils literal notranslate"><span class="pre">t</span></code> and
<code class="docutils literal notranslate"><span class="pre">μ</span></code> must each be a single number, given in that
order. The bin represents the average of triangles
with <span class="math notranslate nohighlight">\((k, t, \mu)\)</span> in the vicinity of the
values specified, in accordance with the
<code class="docutils literal notranslate"><span class="pre">'shellthickness'</span></code> sub-parameter (see below).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{'k':</span> <span class="pre">&lt;...&gt;,</span> <span class="pre">'t':</span> <span class="pre">&lt;...&gt;,</span> <span class="pre">'μ':</span> <span class="pre">&lt;...&gt;}</span></code>: Multiple
configurations spanning a chunk of configuration
space. Here each <code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code> is stand-in for either a
single number or multiple numbers (e.g. within in a
<code class="docutils literal notranslate"><span class="pre">list</span></code>). All configurations in the Cartesian
product of the three <code class="docutils literal notranslate"><span class="pre">&lt;...&gt;</span></code> will be included.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'&lt;named-configuration&gt;'</span></code>: Multiple configurations
spanning a named portion of configuration space.
Many typical configurations are known to
CO<em>N</em>CEPT by name. These include:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'equilateral'</span></code>: <span class="math notranslate nohighlight">\(t = 1\)</span>,
<span class="math notranslate nohighlight">\(\mu = \frac{1}{2}\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 = k_2 = k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'stretched'</span></code>: <span class="math notranslate nohighlight">\(t = \frac{1}{2}\)</span>,
<span class="math notranslate nohighlight">\(\mu = 1\)</span>, <span class="math notranslate nohighlight">\(\,(k_1 = 2k_2 = 2k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'squeezed'</span></code>: <span class="math notranslate nohighlight">\(t = 1\)</span>, <span class="math notranslate nohighlight">\(\mu = 0.99\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 = k_2, k_3 \approx 0).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'isosceles</span> <span class="pre">right'</span></code>: <span class="math notranslate nohighlight">\(t = 1/\sqrt{2}\)</span>,
<span class="math notranslate nohighlight">\(\mu = 1/\sqrt{2}\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 = \sqrt{2}k_2 = \sqrt{2}k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'L-isosceles'</span></code>: <span class="math notranslate nohighlight">\(t = 1\)</span>,
<span class="math notranslate nohighlight">\(\frac{1}{2} \le \mu &lt; 1\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 = k_2 \ge k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'S-isosceles'</span></code>:
<span class="math notranslate nohighlight">\(\frac{1}{2} \le t \le 1\)</span>,
<span class="math notranslate nohighlight">\(\mu = (2t)^{-1}\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 \ge k_2 = k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'elongated'</span></code>/<code class="docutils literal notranslate"><span class="pre">'flattened'</span></code>/<code class="docutils literal notranslate"><span class="pre">'folded'</span></code>/<code class="docutils literal notranslate"><span class="pre">'linear'</span></code>:
<span class="math notranslate nohighlight">\(\frac{1}{2} \le t &lt; 1\)</span>, <span class="math notranslate nohighlight">\(\mu = 1\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1 = k_2 + k_3).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'right'</span></code>: <span class="math notranslate nohighlight">\(1/\sqrt{2} \le t = \mu &lt; 1\)</span>
<span class="math notranslate nohighlight">\(\,(k_1^2 = k_2^2 + k_3^2).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'acute'</span></code>: <span class="math notranslate nohighlight">\(1/\sqrt{2} \le t \le 1\)</span>,
<span class="math notranslate nohighlight">\((2t)^{-1} \le \mu &lt; 1\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1^2 \le k_2^2 + k_3^2).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'obtuse'</span></code> <span class="math notranslate nohighlight">\(1/\sqrt{2} \le \mu &lt; 1\)</span>,
<span class="math notranslate nohighlight">\((2\mu)^{-1} \le t &lt; \mu\)</span>,
<span class="math notranslate nohighlight">\(\,(k_1^2 \ge k_2^2 + k_3^2).\)</span></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'all'</span></code> <span class="math notranslate nohighlight">\(\frac{1}{2} \le t \le 1\)</span>,
<span class="math notranslate nohighlight">\((2t)^{-1} \le \mu &lt; 1\)</span>
<span class="math notranslate nohighlight">\(\,(k_1 \ge k_2 \ge k_3).\)</span></p></li>
</ul>
<p>In all of th above named configurations,
<span class="math notranslate nohighlight">\(k = k_1\)</span> goes from <code class="docutils literal notranslate"><span class="pre">5*k_f</span></code> to
<code class="docutils literal notranslate"><span class="pre">2/3*nyquist</span></code>, with <code class="docutils literal notranslate"><span class="pre">k_f</span> <span class="pre">=</span> <span class="pre">2*π/boxsize</span></code> and
<code class="docutils literal notranslate"><span class="pre">nyquist</span> <span class="pre">=</span> <span class="pre">gridsize//2*k_f</span></code>.</p>
<p>For all of the bove named configurations,
the convention that <span class="math notranslate nohighlight">\(k_1 \ge k_2 \ge k_3\)</span> is
used, corresponding to</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{1}{2} &amp;\le t \le 1\,, \\
\frac{1}{2} &amp;\le \mu \le 1\,, \\
\frac{1}{2} &amp;\le t\mu\,.\end{split}\]</div>
<p>Note that this restriction is not imposed when
manually specifying <span class="math notranslate nohighlight">\(k\)</span>, <span class="math notranslate nohighlight">\(t\)</span>,
<span class="math notranslate nohighlight">\(\mu\)</span>.</p>
</li>
<li><p>(<code class="docutils literal notranslate"><span class="pre">'&lt;named-configuration&gt;'</span></code>, n): Named portion of
configuration space like above, with the number of
bins set through the integer <code class="docutils literal notranslate"><span class="pre">n</span></code>. This is
interpreted as the number of bins per decade along
the <span class="math notranslate nohighlight">\(k = k_1\)</span> dimension, with the total number
further depending on the global grid size in use for
the bispectrum measurement. The <span class="math notranslate nohighlight">\(t\)</span> and
<span class="math notranslate nohighlight">\(\mu\)</span> dimensions are likewise subdivided,
using the same total number of cuts as for the
<span class="math notranslate nohighlight">\(k\)</span> dimension.</p>
<p>When <code class="docutils literal notranslate"><span class="pre">n</span></code> is not specified (corresponding to the
previous bullet point), <code class="docutils literal notranslate"><span class="pre">n</span></code> defaults to <code class="docutils literal notranslate"><span class="pre">20</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>From the above, it can be shown that the total
number of bispectrum bins in the named
configurations grows approximately like
<span class="math notranslate nohighlight">\(\mathcal{O}[(n^d(\ln (n_{\text{bs}}) - 1)^d]\)</span>,
with <span class="math notranslate nohighlight">\(n_{\text{bs}}\)</span> the global grid size
used for the bispectrum computation and <span class="math notranslate nohighlight">\(d\)</span>
the dimensionality of the selected chunk of
parameter space:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(d = 1\)</span>: <code class="docutils literal notranslate"><span class="pre">'equilateral'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'stretched'</span></code>, <code class="docutils literal notranslate"><span class="pre">'squeezed'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'isosceles</span> <span class="pre">right'</span></code>.</p></li>
<li><p><span class="math notranslate nohighlight">\(d = 2\)</span>: <code class="docutils literal notranslate"><span class="pre">'L-isosceles'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'S-isosceles'</span></code>, <code class="docutils literal notranslate"><span class="pre">'elongated'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'right'</span></code>.</p></li>
<li><p><span class="math notranslate nohighlight">\(d = 3\)</span>: <code class="docutils literal notranslate"><span class="pre">'acute'</span></code>, <code class="docutils literal notranslate"><span class="pre">'obtuse'</span></code>,
<code class="docutils literal notranslate"><span class="pre">'all'</span></code>.</p></li>
</ul>
</div>
</li>
<li><p>Finally, multiple specifications of any of the above
kinds can be simultaneously selected by writing them
together in a <code class="docutils literal notranslate"><span class="pre">list</span></code>.</p></li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">'shellthickness'</span></code>: Specifies the thickness of the
three <span class="math notranslate nohighlight">\(k\)</span> shells (one for each of <span class="math notranslate nohighlight">\(k_1\)</span>,
<span class="math notranslate nohighlight">\(k_2\)</span>, <span class="math notranslate nohighlight">\(k_3\)</span>) making up each bispectrum
bin. By specifying different thicknesses at different
<span class="math notranslate nohighlight">\(k\)</span>, a running (logarithmically interpolated)
thickness is obtained. Both the thickness values
themselves and the <span class="math notranslate nohighlight">\(k\)</span> values (shell radii) at
which they apply can be given as either numbers (in
units of inverse length) or as <code class="docutils literal notranslate"><span class="pre">str</span></code>s. In the
latter case, the following sub<code class="docutils literal notranslate"><span class="pre">str</span></code>s are
dynamically substituted:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">'k_min'</span></code>: <code class="docutils literal notranslate"><span class="pre">2*π/boxsize</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'k_max'</span></code>: <code class="docutils literal notranslate"><span class="pre">sqrt(3)*(gridsize//2)*k_min</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'gridsize'</span></code>: <code class="docutils literal notranslate"><span class="pre">gridsize</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'nyquist'</span></code>: <code class="docutils literal notranslate"><span class="pre">gridsize//2*k_min</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">'k_fundamental'</span></code>/<code class="docutils literal notranslate"><span class="pre">'k_f'</span></code>: <code class="docutils literal notranslate"><span class="pre">2*π/boxsize</span></code>.</p></li>
</ul>
<p>For specifying individual shell thicknesses for the
<span class="math notranslate nohighlight">\(k_1\)</span>, <span class="math notranslate nohighlight">\(k_2\)</span> and <span class="math notranslate nohighlight">\(k_3\)</span> shells,
<code class="docutils literal notranslate"><span class="pre">'shellthickness'</span></code> should be specified as a <code class="docutils literal notranslate"><span class="pre">list</span></code>
of three <code class="docutils literal notranslate"><span class="pre">dict</span></code>s. If instead <code class="docutils literal notranslate"><span class="pre">'shellthickness'</span></code>
is given as just a single such <code class="docutils literal notranslate"><span class="pre">dict</span></code>, the same
shell thickness will be used for all three shells.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For all sub-parameters except
<code class="docutils literal notranslate"><span class="pre">'upstream</span> <span class="pre">gridsize'</span></code>, the keys used within the
<a class="reference internal" href="parameters.html#components-and-selections"><span class="std std-ref">component selection</span></a>
sub-<code class="docutils literal notranslate"><span class="pre">dict</span></code>s may refer to either a single
component or a combination of components. In the case
of the latter, this designates a combined (auto)
bispectrum.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Use the equilateral configurations for bispectra of the
component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;equilateral&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If we want more control over the number of bispectrum
bins (the density of sampling points), we can specify
the number of bins/subdivisions per decade along the
<span class="math notranslate nohighlight">\(k = k_1\)</span> dimension (with the number of
subdivisions along the <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(\mu\)</span>
dimensions also adapting accordingly):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Instead of using the predefined name <code class="docutils literal notranslate"><span class="pre">'equilateral'</span></code>,
we can specify such configurations — defined by having
<span class="math notranslate nohighlight">\(t = 1\)</span> and <span class="math notranslate nohighlight">\(\mu = \frac{1}{2}\)</span>
— manually:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="s1">&#39;logspace(log10(k_f), log10(nyquist), int(30*log10(nyquist/k_f)))&#39;</span><span class="p">,</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;μ&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above specification for <code class="docutils literal notranslate"><span class="pre">'k'</span></code> results in 30 values
per decade, placed logarithmically equidistant between
<code class="docutils literal notranslate"><span class="pre">k_f</span></code> and <code class="docutils literal notranslate"><span class="pre">nyquist</span></code>; a wider parameter range than
what is used by the built-in <code class="docutils literal notranslate"><span class="pre">'equilateral'</span></code>
configuration.</p>
<p>If we prefer, we might instead list each equilateral bin
individually:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">_gridsize</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># global grid size for bispectrum</span>
<span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">logspace</span><span class="p">(</span>
                <span class="n">log10</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">π</span><span class="o">/</span><span class="n">boxsize</span><span class="p">),</span>
                <span class="n">log10</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">π</span><span class="o">/</span><span class="n">boxsize</span><span class="o">*</span><span class="p">(</span><span class="n">_gridsize</span><span class="o">//</span><span class="mi">2</span><span class="p">)),</span>
                <span class="nb">int</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">_gridsize</span><span class="o">//</span><span class="mi">2</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that in the above we have to reference the grid
size explicitly, whereas previously this was encoded in
<code class="docutils literal notranslate"><span class="pre">'nyquist'</span></code>. Likewise we previously made use of the
fundamental frequency <code class="docutils literal notranslate"><span class="pre">'k_f'</span></code>, whereas just above we
write this out explicitly as <code class="docutils literal notranslate"><span class="pre">2*π/boxsize</span></code>. We can
reintroduce <code class="docutils literal notranslate"><span class="pre">'k_f'</span></code> to (perhaps) simplify the above:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">_gridsize</span> <span class="o">=</span> <span class="mi">128</span>  <span class="c1"># global grid size for bispectrum</span>
<span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[</span>
            <span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">q</span><span class="si">}</span><span class="s1">*k_f&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">logspace</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span>
                <span class="n">log10</span><span class="p">(</span><span class="n">_gridsize</span><span class="o">//</span><span class="mi">2</span><span class="p">),</span>
                <span class="nb">int</span><span class="p">(</span><span class="mi">30</span><span class="o">*</span><span class="n">log10</span><span class="p">(</span><span class="n">_gridsize</span><span class="o">//</span><span class="mi">2</span><span class="p">)),</span>
            <span class="p">)</span>
        <span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Use a constant shell thickness equal to three times the
fundamental frequency, for shell <span class="math notranslate nohighlight">\(k_1\)</span>,
shell <span class="math notranslate nohighlight">\(k_2\)</span> and shell <span class="math notranslate nohighlight">\(k_3\)</span>, for
every bispectrum:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;all&#39;</span>             <span class="p">:</span> <span class="p">[</span><span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">],</span>
        <span class="s1">&#39;all combinations&#39;</span><span class="p">:</span> <span class="o">...</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>This may be shortened to</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">],</span>
<span class="p">}</span>
</pre></div>
</div>
<p>or indeed</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 2</strong></p></td>
<td><p></p></td>
<td><p>Use the equilateral configurations for bispectra of the
component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>, with 30
bins per decade along the <span class="math notranslate nohighlight">\(k\)</span> dimension.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Ideally, the concentric shells of different bins should
not overlap, as otherwise the same underlying modes will
each contribute to multiple bins. At the same time, we
would like to include all available modes within our
bins, and so together they should cover all of
configuration space, i.e. we want there to be no gaps
between the concentric shells. Given the 30
logarithmically equidistant shell radii above, we can
match the shell thicknesses in order to achieve this:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;1/30*log(10)*k&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that with the growing shell thickness above,
the usual shell thickness of <span class="math notranslate nohighlight">\(3k_{\text{f}}\)</span> is not
achieved until <span class="math notranslate nohighlight">\(k \sim 40k_{\text{f}}\)</span>. We may
introduce a minimum shell thickness — say of
<span class="math notranslate nohighlight">\(1.5k_{\text{f}}\)</span> — like so:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;max(1.5*k_f, 1/30*log(10)*k)&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The above minimum shell thickness of
<span class="math notranslate nohighlight">\(1.5k_{\text{f}}\)</span> applies for
<span class="math notranslate nohighlight">\(k \lesssim 20k_{\text{f}}\)</span>, though for the very
lowest <span class="math notranslate nohighlight">\(k\)</span> we might want a smaller value. We can
introduce a lowest thickness of e.g.
<span class="math notranslate nohighlight">\(0.25k_{\text{f}}\)</span> below e.g.
<span class="math notranslate nohighlight">\(1k_{\text{f}}\)</span>, with the previous thickness
specification being applied above e.g.
<span class="math notranslate nohighlight">\(10k_{\text{f}}\)</span>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;equilateral&#39;</span><span class="p">,</span> <span class="mi">30</span><span class="p">),</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
             <span class="s1">&#39;1*k_f&#39;</span><span class="p">:</span> <span class="s1">&#39;0.25*k_f&#39;</span><span class="p">,</span>
            <span class="s1">&#39;10*k_f&#39;</span><span class="p">:</span> <span class="s1">&#39;max(1.5*k_f, 1/30*log(10)*k)&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Between the two control points <span class="math notranslate nohighlight">\(1k_{\text{f}}\)</span>
and <span class="math notranslate nohighlight">\(10k_{\text{f}}\)</span>, the shell thickness is
obtained through logarithmic interpolation. For example,
the shell thickness at <span class="math notranslate nohighlight">\(4k_{\text{f}}\)</span> becomes
<span class="math notranslate nohighlight">\(\sim 1.0k_{\text{f}}\)</span>, given the above
specification.</p>
<p>Note the similarity with the above shell thickness
settings and the default settings.</p>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 3</strong></p></td>
<td><p></p></td>
<td><p>Measure the bispectrum for all isosceles configurations
— i.e. both L-isosceles and S-isosceles — for the
component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;L-isosceles&#39;</span><span class="p">,</span> <span class="s1">&#39;S-isosceles&#39;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We might want to explicitly control the number of bins
for each of two configuration subspaces:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[(</span><span class="s1">&#39;L-isosceles&#39;</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;S-isosceles&#39;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Due to the many possible configuration
specifications, the parsing of these specifications
is less robust than what is usually the case. In
particular, swapping <code class="docutils literal notranslate"><span class="pre">list</span></code>s for <code class="docutils literal notranslate"><span class="pre">tuple</span></code>s
or vice versa can lead to erroneous parsing,
ultimately crashing the program. That is, while</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="s1">&#39;L-isosceles&#39;</span><span class="p">,</span> <span class="s1">&#39;S-isosceles&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>is a valid specification, this is not:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="s1">&#39;L-isosceles&#39;</span><span class="p">,</span> <span class="s1">&#39;S-isosceles&#39;</span><span class="p">)</span>  <span class="c1"># ❌</span>
</pre></div>
</div>
</div>
<p>Note that the two sets of bins are written without
separation in the output data file. However, the order
in which the bins appear will always match the order in
which they are specified.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For the case above (and most others), the transition
from one configuration subset to another within a
bispectrum data file can easily be located as the row
where <span class="math notranslate nohighlight">\(k\)</span> <em>de</em>creases in relation to the
previous row.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 4</strong></p></td>
<td><p></p></td>
<td><p>Use a squeezed configurations for bispectra of the
component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;squeezed&#39;</span><span class="p">,</span>  <span class="c1"># or e.g. (squeezed, 20)</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The squeezed configurations are more tricky than other
configurations, as the <span class="math notranslate nohighlight">\(k_3\)</span> shell vanishes in
the squeezed limit <span class="math notranslate nohighlight">\(t\rightarrow 1\)</span>,
<span class="math notranslate nohighlight">\(\mu\rightarrow 0\)</span>, while a reliable bispectrum
measurement requires each shell to contain a substantial
amount of grid points. For the built-in <code class="docutils literal notranslate"><span class="pre">'squeezed'</span></code>,
he values <code class="docutils literal notranslate"><span class="pre">t</span> <span class="pre">=</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">μ</span> <span class="pre">=</span> <span class="pre">0.99</span></code> are chosen. We can use
a less restrictive <code class="docutils literal notranslate"><span class="pre">μ</span> <span class="pre">=</span> <span class="pre">0.95</span></code> — leading to a less
noisy bispectrum — by specifying the configurations
manually:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s1">&#39;logspace(log10(5*k_f), &#39;</span>
                <span class="s1">&#39;log10(2/3*nyquist), &#39;</span>
                <span class="s1">&#39;int(20*log10(2/3*nyquist/(5*k_f))))&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;μ&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above we have kept the <span class="math notranslate nohighlight">\(k = k_1\)</span> range the
same as the default; 20 points logarithmically
equidistant between 5 times the fundamental frequency
and two-thirds times the Nyquist frequency. Note however
that some of these configurations are rejected when
using the built-in <code class="docutils literal notranslate"><span class="pre">'squeezed'</span></code>, as <span class="math notranslate nohighlight">\(k_3\)</span> is
deemed too small.</p>
<p>With <span class="math notranslate nohighlight">\(k_3\)</span> much smaller than <span class="math notranslate nohighlight">\(k_1\)</span> and
<span class="math notranslate nohighlight">\(k_2\)</span> it might makes sense to assign the
<span class="math notranslate nohighlight">\(k_3\)</span> shell a thickness that is different from
the one used by the <span class="math notranslate nohighlight">\(k_1\)</span> and <span class="math notranslate nohighlight">\(k_2\)</span> shell:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="p">(</span>
                <span class="s1">&#39;logspace(log10(5*k_f), &#39;</span>
                <span class="s1">&#39;log10(2/3*nyquist), &#39;</span>
                <span class="s1">&#39;int(20*log10(2/3*nyquist/(5*k_f))))&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
            <span class="s1">&#39;μ&#39;</span><span class="p">:</span> <span class="mf">0.95</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;3*k_f&#39;</span><span class="p">,</span> <span class="s1">&#39;1.5*k_f&#39;</span><span class="p">],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 5</strong></p></td>
<td><p></p></td>
<td><p>Imitate the way
<a class="reference external" href="https://pylians3.readthedocs.io/">Pylians</a> computes
bispectra:</p>
<ul class="simple">
<li><p>Specify <span class="math notranslate nohighlight">\(k_1 = |\boldsymbol{k}_1|\)</span> and
<span class="math notranslate nohighlight">\(k_2 = |\boldsymbol{k}_2|\)</span> as well as the angle
<span class="math notranslate nohighlight">\(\theta = \cos^{-1}(\hat{\boldsymbol{k}}_1 \cdot \hat{\boldsymbol{k}}_2)\)</span>
(opposite sign convention compared to CO<em>N</em>CEPT,
making <span class="math notranslate nohighlight">\(\mu = -\cos\theta\)</span>).</p></li>
<li><p>Use a constant shell thickness of twice the
fundamental frequency.</p></li>
</ul>
<p>Use <span class="math notranslate nohighlight">\(k_1 = 1.1\, h\, \text{Mpc}^{-1}\)</span>,
<span class="math notranslate nohighlight">\(k_2 = 0.8\, h\, \text{Mpc}^{-1}\)</span> and <span class="math notranslate nohighlight">\(50\)</span>
values of <span class="math notranslate nohighlight">\(\theta\)</span> between <span class="math notranslate nohighlight">\(0\)</span> and
<span class="math notranslate nohighlight">\(\require{upgreek}\uppi\)</span>. Apply all of this for
the component with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">_k1</span> <span class="o">=</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">Mpc</span>
<span class="n">_k2</span> <span class="o">=</span> <span class="mf">0.8</span><span class="o">*</span><span class="n">h</span><span class="o">/</span><span class="n">Mpc</span>
<span class="n">_θ</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">_k1</span><span class="p">,</span>
            <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">_k2</span><span class="o">/</span><span class="n">_k1</span><span class="p">,</span>
            <span class="s1">&#39;μ&#39;</span><span class="p">:</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">_θ</span><span class="p">),</span>
        <span class="p">},</span>
    <span class="p">},</span>
    <span class="s1">&#39;shellthickness&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="s1">&#39;2*k_f&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>In order to fully reduce the bispectrum computation
within CO<em>N</em>CEPT to one consistent with that of
<a class="reference external" href="https://pylians3.readthedocs.io/">Pylians</a>, one
should further:</p>
<ul class="simple">
<li><p>Disable
<a class="reference internal" href="#bispec-antialiasing"><span class="std std-ref">shell anti-aliasing</span></a>.</p></li>
<li><p>Disable interlacing (specified trough
<code class="docutils literal notranslate"><span class="pre">bispec_options['interlace']</span></code>).</p></li>
<li><p>Switch to <a class="reference internal" href="simulation.html#cell-centered"><span class="std std-ref">cell-vertex</span></a> grid
discretisation.</p></li>
</ul>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 6</strong></p></td>
<td><p></p></td>
<td><p>Sample the full configuration space for the component
with a name/species of <code class="docutils literal notranslate"><span class="pre">'matter'</span></code>:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>We recall that the full configuration space is
parametrised as</p>
<div class="math notranslate nohighlight">
\[\begin{split}\frac{1}{2} &amp;\le t \le 1\,, \\
\frac{1}{2} &amp;\le \mu \le 1\,, \\
\frac{1}{2} &amp;\le t\mu\,,\end{split}\]</div>
<p>which uniquely covers each configuration (triangle
shape) for a given <span class="math notranslate nohighlight">\(k\)</span> (triangle size). While the
built-in <code class="docutils literal notranslate"><span class="pre">'all'</span></code> samples configuration space evenly
(logarithmically in <span class="math notranslate nohighlight">\(k\)</span>, linear in <span class="math notranslate nohighlight">\(t\)</span> and
<span class="math notranslate nohighlight">\(\mu\)</span>), we might instead wish to sample randomly.</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>  <span class="c1"># for consistent bins</span>
<span class="k">def</span> <span class="nf">_sample</span><span class="p">():</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">k</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;k_min*(k_max/k_min)**</span><span class="si">{</span><span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="n">μ</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="o">/</span><span class="mi">2</span>
    <span class="k">if</span> <span class="n">t</span><span class="o">*</span><span class="n">μ</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">_sample</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">k</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">μ</span>
<span class="n">bispec_options</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;configuration&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;matter&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">_sample</span><span class="p">()</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">)],</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Note that the above samples the entire possible
<span class="math notranslate nohighlight">\(k = k_1\)</span> range, whereas this range is reduced
for the built-in <code class="docutils literal notranslate"><span class="pre">'all'</span></code> (as well as the other named
configurations).</p>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="bispec-antialiasing">
<span id="id6"></span><h2><a class="toc-backref" href="#id14" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">bispec_antialiasing</span></code></a><a class="headerlink" href="#bispec-antialiasing" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifies whether to enable anti-aliasing for
bispectrum shells</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kc">True</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>Numerically, each bispectrum shell is a collection of
Fourier grid cells, each positioned a distance (measured
from their centres) of about <span class="math notranslate nohighlight">\(k\)</span> from the origin
(with <span class="math notranslate nohighlight">\(k = k_1\)</span> for the first shell,
<span class="math notranslate nohighlight">\(k = k_2\)</span> for the second shell, <span class="math notranslate nohighlight">\(k = k_3\)</span>
for the third shell). Call this distance the radial
coordinate of the cell. With shell anti-aliasing
disabled (not the default), a cell is included in the
shell if its radial coordinate lies between
<span class="math notranslate nohighlight">\(k - s/2\)</span> and <span class="math notranslate nohighlight">\(k + s/2\)</span>, <span class="math notranslate nohighlight">\(s\)</span> being the
shell thickness of the shell with radius <span class="math notranslate nohighlight">\(k\)</span>.</p>
<p>The simple scheme for cell inclusion/exclusion within a
shell described above comes with a number of drawbacks,
arising from allowing the discrete nature of the
underlying grid to spread into the shell. A more
sophisticated approach is to treat the shells as being
truly spherical and continuous, with cells on the
boundary being taken into account in proportion to their
volumetric overlap with the shell. This is what we refer
to as shell anti-aliasing (enabled by default).</p>
<p>Note that with shell anti-aliasing, the inner and outer
shell radii — related by their difference equalling
the shell thickness <span class="math notranslate nohighlight">\(s\)</span> — can now be chosen such
that the average (weighted) radial coordinate of the
cells within the shell exactly equals the radius
<span class="math notranslate nohighlight">\(k\)</span> of the shell, i.e. a measured bispectrum value
<span class="math notranslate nohighlight">\(B(k_1, k_2, k_3)\)</span> really do belong <em>exactly</em> to
the given <span class="math notranslate nohighlight">\(k_1\)</span>, <span class="math notranslate nohighlight">\(k_2\)</span>, <span class="math notranslate nohighlight">\(k_3\)</span>. This is
unlike the non-anti-aliased case where small changes to
<span class="math notranslate nohighlight">\(k_1\)</span>, <span class="math notranslate nohighlight">\(k_2\)</span>, <span class="math notranslate nohighlight">\(k_3\)</span> do not alter the
measured value <span class="math notranslate nohighlight">\(B(k_1, k_2, k_3)\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For all but the smallest <span class="math notranslate nohighlight">\(k\)</span>, CO<em>N</em>CEPT in
fact chooses the inner and outer shell radii not so
that the average radial coordinate of the cells
results in the radius <span class="math notranslate nohighlight">\(k\)</span> of the shell, but
instead so that the average of the logarithm of the
radial coordinates of the cells results in
<span class="math notranslate nohighlight">\(\log k\)</span>.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Turn off bispectrum shell anti-aliasing:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">bispec_antialiasing</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
<p>Though generally not preferable, this is useful if the
resulting bispectra are to be compared with ones
computed by a different code which does not have this
feature.</p>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="class-dedicated-spectra">
<span id="id7"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">class_dedicated_spectra</span></code></a><a class="headerlink" href="#class-dedicated-spectra" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Specifies whether to carry out a dedicated CLASS
computation for use with perturbation theory spectra</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kc">False</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>When <code class="docutils literal notranslate"><span class="pre">False</span></code> (the default), rather than running CLASS,
already obtained CLASS results are reused whenever a
perturbation theory spectrum (a linear power spectrum or
a tree-level bispectrum) is requested, even if this
does not cover the entire <span class="math notranslate nohighlight">\(k\)</span> region in question.
This often leads to a few missing (<code class="docutils literal notranslate"><span class="pre">NaN</span></code>) values in
the perturbation theory columns of output spectra, but
saves time as fewer invocations of CLASS are needed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This will only affect the perturbation theory output
in power spectrum and bispectrum data files; the
CLASS data used internally for simulation purposes
will always be complete.</p>
</div>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Always rerun CLASS as necessary, ensuring fully
populated perturbation theory data in spectral output:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_dedicated_spectra</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
<hr class="docutils" />
</section>
<section id="class-modes-per-decade">
<span id="id8"></span><h2><a class="toc-backref" href="#id16" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">class_modes_per_decade</span></code></a><a class="headerlink" href="#class-modes-per-decade" title="Permalink to this heading"></a></h2>
<table>
<tbody>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Description</strong></p></td>
<td><p></p></td>
<td><p>Number of Fourier modes <span class="math notranslate nohighlight">\(k\)</span> per decade in
CLASS computations</p></td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Default</strong></p></td>
<td><p></p></td>
<td><div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="mf">3e-3</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
    <span class="mf">3e-2</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
    <span class="mf">3e-1</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
       <span class="mi">1</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Elaboration</strong></p></td>
<td><p></p></td>
<td><p>This parameter determines the number of CLASS
perturbations to compute, by specifying the density
of Fourier modes <span class="math notranslate nohighlight">\(k\)</span> as a (running) number per
decade. The resulting tabulation of <span class="math notranslate nohighlight">\(k\)</span> is
employed for all CLASS perturbations, which are used
for e.g. initial conditions. The default choice yields a
relatively sparse tabulation of perturbations, except
around baryon acoustic oscillations, where more detail
is added.</p>
<p>If you seek highly resolved linear power spectra or
tree-level, make sure to not just increase
<code class="docutils literal notranslate"><span class="pre">class_modes_per_decade</span></code>, but also enable the
<code class="docutils literal notranslate"><span class="pre">class_dedicated_spectra</span></code>
<a class="reference internal" href="#class-dedicated-spectra"><span class="std std-ref">parameter</span></a>.</p>
</td>
</tr>
<tr class="row-even"><td><p></p></td>
<td><p><strong>Example 0</strong></p></td>
<td><p></p></td>
<td><p>Use a constant <span class="math notranslate nohighlight">\(20\)</span> modes per decade, i.e.
<span class="math notranslate nohighlight">\(20\)</span> values of <span class="math notranslate nohighlight">\(k\)</span> placed logarithmically
equidistant between
<span class="math notranslate nohighlight">\(k = 10^{-3}\,\text{Mpc}^{-1}\)</span> and
<span class="math notranslate nohighlight">\(k = 10^{-2}\,\text{Mpc}^{-1}\)</span>, between
<span class="math notranslate nohighlight">\(k = 10^{-2}\,\text{Mpc}^{-1}\)</span> and
<span class="math notranslate nohighlight">\(k = 10^{-1}\,\text{Mpc}^{-1}\)</span>, etc:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_modes_per_decade</span> <span class="o">=</span> <span class="mi">20</span>
</pre></div>
</div>
</td>
</tr>
<tr class="row-odd"><td><p></p></td>
<td><p><strong>Example 1</strong></p></td>
<td><p></p></td>
<td><p>Use <span class="math notranslate nohighlight">\(50\)</span> modes per decade around
<span class="math notranslate nohighlight">\(k = 10^{-4}\,\text{Mpc}^{-1}\)</span> and <span class="math notranslate nohighlight">\(10\)</span>
modes per decade around
<span class="math notranslate nohighlight">\(k = 10^1\,\text{Mpc}^{-1}\)</span>, with a running
number per decade in between found through logarithmic
interpolation (resulting in e.g. <span class="math notranslate nohighlight">\(42\)</span> modes per
decade around <span class="math notranslate nohighlight">\(k = 10^{-3}\,\text{Mpc}^{-1}\)</span>):</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_modes_per_decade</span> <span class="o">=</span> <span class="p">{</span>
    <span class="mf">1e-4</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">50</span><span class="p">,</span>
    <span class="mf">1e+1</span><span class="o">/</span><span class="n">Mpc</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="input_output.html" class="btn btn-neutral float-left" title="Input/output" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cosmology.html" class="btn btn-neutral float-right" title="Cosmology" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p></p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>