# GitHub action testing the code base by running the test suite

name: Test suite


on:
  push:
    paths-ignore:
    - '.env'
    - '.gitignore'
    - '.paths'
    - 'COPYING'
    - 'README.md'
    - 'installer'
    - 'concept/docs/**'


env:
  runner_environment: ubuntu-18.04


jobs:

  test_basic:
    name: Test basic
    runs-on: ${{ env.runner_environment }}
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Run test
        run: |
          docker run \
          -e GITHUB_JOB \
          -v ${GITHUB_WORKSPACE}:/github \
          jmddk/concept:master /usr/bin/env bash -c ': \
              && cd / \
              && source ~/.bashrc \
              && rm -rf "${concept_dir}" \
              && cp -r /github/concept "${concept_dir}" \
              && concept -t ${GITHUB_JOB/test_} \
              && mkdir /github/built \
              && cp "${concept_dir}/"*.so /github/built/ \
          '
      - name: Upload built
        uses: actions/upload-artifact@v1
        with:
          name: built

  test_friedmann:
    name: Test friedmann
    needs: test_basic
    runs-on: ubuntu-18.04
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Download built
        uses: actions/download-artifact@v1
        with:
          name: built
      - name: Run test
        run: |
          docker run \
          -e GITHUB_JOB \
          -v ${GITHUB_WORKSPACE}:/github \
          jmddk/concept:master /usr/bin/env bash -c ': \
              && cd / \
              && source ~/.bashrc \
              && rm -rf "${concept_dir}" \
              && cp -r /github/concept "${concept_dir}" \
              && cp /github/built/* "${concept_dir}/" \
              && concept -t ${GITHUB_JOB/test_} \
          '



